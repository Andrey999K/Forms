import{g as be,K as B,a as fe,r as ge,u as T,m as Pe,b as a,C as oe,i as pe,c as E,d as he,e as Re,j as i,G as te,L as k,B as Z,f as ze,h as D,k as De,l as Be,n as A,T as de,R as Me,o as ue,p as _e,s as Fe,q as He}from"./index-BX4s7O1H.js";import{S as L,u as We}from"./base-GP4M9XSg.js";import{M as Ae,a as Le,b as ke}from"./index-DH8GKkHB.js";import{R as Ze,C as Ve}from"./row-B2jg4qcI.js";import{u as qe}from"./usePageTitle-Dc7S7kMB.js";import{S as Ue}from"./index-Db3dTZYw.js";import{I as Xe}from"./index-BEBPbsRa.js";import"./SearchOutlined-DY59NGTd.js";const Ge=new B("antStatusProcessing",{"0%":{transform:"scale(0.8)",opacity:.5},"100%":{transform:"scale(2.4)",opacity:0}}),Ke=new B("antZoomBadgeIn",{"0%":{transform:"scale(0) translate(50%, -50%)",opacity:0},"100%":{transform:"scale(1) translate(50%, -50%)"}}),Ye=new B("antZoomBadgeOut",{"0%":{transform:"scale(1) translate(50%, -50%)"},"100%":{transform:"scale(0) translate(50%, -50%)",opacity:0}}),Qe=new B("antNoWrapperZoomBadgeIn",{"0%":{transform:"scale(0)",opacity:0},"100%":{transform:"scale(1)"}}),Je=new B("antNoWrapperZoomBadgeOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)",opacity:0}}),et=new B("antBadgeLoadingCircle",{"0%":{transformOrigin:"50%"},"100%":{transform:"translate(50%, -50%) rotate(360deg)",transformOrigin:"50%"}}),tt=e=>{const{componentCls:t,iconCls:s,antCls:o,badgeShadowSize:n,textFontSize:u,textFontSizeSM:c,statusSize:v,dotSize:C,textFontWeight:g,indicatorHeight:m,indicatorHeightSM:r,marginXS:p,calc:h}=e,b=`${o}-scroll-number`,S=fe(e,(x,N)=>{let{darkColor:f}=N;return{[`&${t} ${t}-color-${x}`]:{background:f,[`&:not(${t}-count)`]:{color:f},"a:hover &":{background:f}}}});return{[t]:Object.assign(Object.assign(Object.assign(Object.assign({},ge(e)),{position:"relative",display:"inline-block",width:"fit-content",lineHeight:1,[`${t}-count`]:{display:"inline-flex",justifyContent:"center",zIndex:e.indicatorZIndex,minWidth:m,height:m,color:e.badgeTextColor,fontWeight:g,fontSize:u,lineHeight:T(m),whiteSpace:"nowrap",textAlign:"center",background:e.badgeColor,borderRadius:h(m).div(2).equal(),boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`,transition:`background ${e.motionDurationMid}`,a:{color:e.badgeTextColor},"a:hover":{color:e.badgeTextColor},"a:hover &":{background:e.badgeColorHover}},[`${t}-count-sm`]:{minWidth:r,height:r,fontSize:c,lineHeight:T(r),borderRadius:h(r).div(2).equal()},[`${t}-multiple-words`]:{padding:`0 ${T(e.paddingXS)}`,bdi:{unicodeBidi:"plaintext"}},[`${t}-dot`]:{zIndex:e.indicatorZIndex,width:C,minWidth:C,height:C,background:e.badgeColor,borderRadius:"100%",boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`},[`${t}-count, ${t}-dot, ${b}-custom-component`]:{position:"absolute",top:0,insetInlineEnd:0,transform:"translate(50%, -50%)",transformOrigin:"100% 0%",[`&${s}-spin`]:{animationName:et,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&${t}-status`]:{lineHeight:"inherit",verticalAlign:"baseline",[`${t}-status-dot`]:{position:"relative",top:-1,display:"inline-block",width:v,height:v,verticalAlign:"middle",borderRadius:"50%"},[`${t}-status-success`]:{backgroundColor:e.colorSuccess},[`${t}-status-processing`]:{overflow:"visible",color:e.colorInfo,backgroundColor:e.colorInfo,borderColor:"currentcolor","&::after":{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:"100%",borderWidth:n,borderStyle:"solid",borderColor:"inherit",borderRadius:"50%",animationName:Ge,animationDuration:e.badgeProcessingDuration,animationIterationCount:"infinite",animationTimingFunction:"ease-in-out",content:'""'}},[`${t}-status-default`]:{backgroundColor:e.colorTextPlaceholder},[`${t}-status-error`]:{backgroundColor:e.colorError},[`${t}-status-warning`]:{backgroundColor:e.colorWarning},[`${t}-status-text`]:{marginInlineStart:p,color:e.colorText,fontSize:e.fontSize}}}),S),{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:Ke,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`${t}-zoom-leave`]:{animationName:Ye,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`&${t}-not-a-wrapper`]:{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:Qe,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`${t}-zoom-leave`]:{animationName:Je,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`&:not(${t}-status)`]:{verticalAlign:"middle"},[`${b}-custom-component, ${t}-count`]:{transform:"none"},[`${b}-custom-component, ${b}`]:{position:"relative",top:"auto",display:"block",transformOrigin:"50% 50%"}},[b]:{overflow:"hidden",transition:`all ${e.motionDurationMid} ${e.motionEaseOutBack}`,[`${b}-only`]:{position:"relative",display:"inline-block",height:m,transition:`all ${e.motionDurationSlow} ${e.motionEaseOutBack}`,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden",[`> p${b}-only-unit`]:{height:m,margin:0,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden"}},[`${b}-symbol`]:{verticalAlign:"top"}},"&-rtl":{direction:"rtl",[`${t}-count, ${t}-dot, ${b}-custom-component`]:{transform:"translate(-50%, -50%)"}}})}},xe=e=>{const{fontHeight:t,lineWidth:s,marginXS:o,colorBorderBg:n}=e,u=t,c=s,v=e.colorTextLightSolid,C=e.colorError,g=e.colorErrorHover;return Pe(e,{badgeFontHeight:u,badgeShadowSize:c,badgeTextColor:v,badgeColor:C,badgeColorHover:g,badgeShadowColor:n,badgeProcessingDuration:"1.2s",badgeRibbonOffset:o,badgeRibbonCornerTransform:"scaleY(0.75)",badgeRibbonCornerFilter:"brightness(75%)"})},Ce=e=>{const{fontSize:t,lineHeight:s,fontSizeSM:o,lineWidth:n}=e;return{indicatorZIndex:"auto",indicatorHeight:Math.round(t*s)-2*n,indicatorHeightSM:t,dotSize:o/2,textFontSize:o,textFontSizeSM:o,textFontWeight:"normal",statusSize:o/2}},ot=be("Badge",e=>{const t=xe(e);return tt(t)},Ce),nt=e=>{const{antCls:t,badgeFontHeight:s,marginXS:o,badgeRibbonOffset:n,calc:u}=e,c=`${t}-ribbon`,v=`${t}-ribbon-wrapper`,C=fe(e,(g,m)=>{let{darkColor:r}=m;return{[`&${c}-color-${g}`]:{background:r,color:r}}});return{[v]:{position:"relative"},[c]:Object.assign(Object.assign(Object.assign(Object.assign({},ge(e)),{position:"absolute",top:o,padding:`0 ${T(e.paddingXS)}`,color:e.colorPrimary,lineHeight:T(s),whiteSpace:"nowrap",backgroundColor:e.colorPrimary,borderRadius:e.borderRadiusSM,[`${c}-text`]:{color:e.badgeTextColor},[`${c}-corner`]:{position:"absolute",top:"100%",width:n,height:n,color:"currentcolor",border:`${T(u(n).div(2).equal())} solid`,transform:e.badgeRibbonCornerTransform,transformOrigin:"top",filter:e.badgeRibbonCornerFilter}}),C),{[`&${c}-placement-end`]:{insetInlineEnd:u(n).mul(-1).equal(),borderEndEndRadius:0,[`${c}-corner`]:{insetInlineEnd:0,borderInlineEndColor:"transparent",borderBlockEndColor:"transparent"}},[`&${c}-placement-start`]:{insetInlineStart:u(n).mul(-1).equal(),borderEndStartRadius:0,[`${c}-corner`]:{insetInlineStart:0,borderBlockEndColor:"transparent",borderInlineStartColor:"transparent"}},"&-rtl":{direction:"rtl"}})}},st=be(["Badge","Ribbon"],e=>{const t=xe(e);return nt(t)},Ce),rt=e=>{const{className:t,prefixCls:s,style:o,color:n,children:u,text:c,placement:v="end",rootClassName:C}=e,{getPrefixCls:g,direction:m}=a.useContext(oe),r=g("ribbon",s),p=`${r}-wrapper`,[h,b,S]=st(r,p),x=pe(n,!1),N=E(r,`${r}-placement-${v}`,{[`${r}-rtl`]:m==="rtl",[`${r}-color-${n}`]:x},t),f={},$={};return n&&!x&&(f.background=n,$.color=n),h(a.createElement("div",{className:E(p,C,b,S)},u,a.createElement("div",{className:E(N,b),style:Object.assign(Object.assign({},f),o)},a.createElement("span",{className:`${r}-text`},c),a.createElement("div",{className:`${r}-corner`,style:$}))))},me=e=>{const{prefixCls:t,value:s,current:o,offset:n=0}=e;let u;return n&&(u={position:"absolute",top:`${n}00%`,left:0}),a.createElement("span",{style:u,className:E(`${t}-only-unit`,{current:o})},s)};function at(e,t,s){let o=e,n=0;for(;(o+10)%10!==t;)o+=s,n+=s;return n}const it=e=>{const{prefixCls:t,count:s,value:o}=e,n=Number(o),u=Math.abs(s),[c,v]=a.useState(n),[C,g]=a.useState(u),m=()=>{v(n),g(u)};a.useEffect(()=>{const h=setTimeout(m,1e3);return()=>clearTimeout(h)},[n]);let r,p;if(c===n||Number.isNaN(n)||Number.isNaN(c))r=[a.createElement(me,Object.assign({},e,{key:n,current:!0}))],p={transition:"none"};else{r=[];const h=n+10,b=[];for(let f=n;f<=h;f+=1)b.push(f);const S=C<u?1:-1,x=b.findIndex(f=>f%10===c);r=(S<0?b.slice(0,x+1):b.slice(x)).map((f,$)=>{const d=f%10;return a.createElement(me,Object.assign({},e,{key:f,value:d,offset:S<0?$-x:$,current:$===x}))}),p={transform:`translateY(${-at(c,n,S)}00%)`}}return a.createElement("span",{className:`${t}-only`,style:p,onTransitionEnd:m},r)};var lt=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const ct=a.forwardRef((e,t)=>{const{prefixCls:s,count:o,className:n,motionClassName:u,style:c,title:v,show:C,component:g="sup",children:m}=e,r=lt(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),{getPrefixCls:p}=a.useContext(oe),h=p("scroll-number",s),b=Object.assign(Object.assign({},r),{"data-show":C,style:c,className:E(h,n,u),title:v});let S=o;if(o&&Number(o)%1===0){const x=String(o).split("");S=a.createElement("bdi",null,x.map((N,f)=>a.createElement(it,{prefixCls:h,count:Number(o),value:N,key:x.length-f})))}return c!=null&&c.borderColor&&(b.style=Object.assign(Object.assign({},c),{boxShadow:`0 0 0 1px ${c.borderColor} inset`})),m?he(m,x=>({className:E(`${h}-custom-component`,x==null?void 0:x.className,u)})):a.createElement(g,Object.assign({},b,{ref:t}),S)});var dt=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const ut=a.forwardRef((e,t)=>{var s,o,n,u,c;const{prefixCls:v,scrollNumberPrefixCls:C,children:g,status:m,text:r,color:p,count:h=null,overflowCount:b=99,dot:S=!1,size:x="default",title:N,offset:f,style:$,className:d,rootClassName:I,classNames:O,styles:j,showZero:V=!1}=e,ne=dt(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","rootClassName","classNames","styles","showZero"]),{getPrefixCls:se,direction:q,badge:l}=a.useContext(oe),y=se("badge",v),[re,ye,Se]=ot(y),U=h>b?`${b}+`:h,_=U==="0"||U===0,$e=h===null||_&&!V,X=(m!=null||p!=null)&&$e,M=S&&!_,P=M?"":U,R=a.useMemo(()=>(P==null||P===""||_&&!V)&&!M,[P,_,V,M]),ae=a.useRef(h);R||(ae.current=h);const z=ae.current,ie=a.useRef(P);R||(ie.current=P);const G=ie.current,le=a.useRef(M);R||(le.current=M);const F=a.useMemo(()=>{if(!f)return Object.assign(Object.assign({},l==null?void 0:l.style),$);const w={marginTop:f[1]};return q==="rtl"?w.left=parseInt(f[0],10):w.right=-parseInt(f[0],10),Object.assign(Object.assign(Object.assign({},w),l==null?void 0:l.style),$)},[q,f,$,l==null?void 0:l.style]),Ne=N??(typeof z=="string"||typeof z=="number"?z:void 0),je=R||!r?null:a.createElement("span",{className:`${y}-status-text`},r),we=!z||typeof z!="object"?void 0:he(z,w=>({style:Object.assign(Object.assign({},F),w.style)})),H=pe(p,!1),Oe=E(O==null?void 0:O.indicator,(s=l==null?void 0:l.classNames)===null||s===void 0?void 0:s.indicator,{[`${y}-status-dot`]:X,[`${y}-status-${m}`]:!!m,[`${y}-color-${p}`]:H}),K={};p&&!H&&(K.color=p,K.background=p);const ce=E(y,{[`${y}-status`]:X,[`${y}-not-a-wrapper`]:!g,[`${y}-rtl`]:q==="rtl"},d,I,l==null?void 0:l.className,(o=l==null?void 0:l.classNames)===null||o===void 0?void 0:o.root,O==null?void 0:O.root,ye,Se);if(!g&&X){const w=F.color;return re(a.createElement("span",Object.assign({},ne,{className:ce,style:Object.assign(Object.assign(Object.assign({},j==null?void 0:j.root),(n=l==null?void 0:l.styles)===null||n===void 0?void 0:n.root),F)}),a.createElement("span",{className:Oe,style:Object.assign(Object.assign(Object.assign({},j==null?void 0:j.indicator),(u=l==null?void 0:l.styles)===null||u===void 0?void 0:u.indicator),K)}),r&&a.createElement("span",{style:{color:w},className:`${y}-status-text`},r)))}return re(a.createElement("span",Object.assign({ref:t},ne,{className:ce,style:Object.assign(Object.assign({},(c=l==null?void 0:l.styles)===null||c===void 0?void 0:c.root),j==null?void 0:j.root)}),g,a.createElement(Re,{visible:!R,motionName:`${y}-zoom`,motionAppear:!1,motionDeadline:1e3},w=>{let{className:Ee}=w;var Y,Q;const Te=se("scroll-number",C),J=le.current,Ie=E(O==null?void 0:O.indicator,(Y=l==null?void 0:l.classNames)===null||Y===void 0?void 0:Y.indicator,{[`${y}-dot`]:J,[`${y}-count`]:!J,[`${y}-count-sm`]:x==="small",[`${y}-multiple-words`]:!J&&G&&G.toString().length>1,[`${y}-status-${m}`]:!!m,[`${y}-color-${p}`]:H});let W=Object.assign(Object.assign(Object.assign({},j==null?void 0:j.indicator),(Q=l==null?void 0:l.styles)===null||Q===void 0?void 0:Q.indicator),F);return p&&!H&&(W=W||{},W.background=p),a.createElement(ct,{prefixCls:Te,show:!R,motionClassName:Ee,className:Ie,count:G,title:Ne,style:W,key:"scrollNumber"},we)}),je))}),ve=ut;ve.Ribbon=rt;const mt=e=>{const{item:t,onDelete:s}=e,o=()=>{s(t.id)};return i.jsxs(te,{className:"h-full flex flex-col !shadow-none",children:[i.jsx("div",{className:"py-3 px-1 flex items-center justify-center ",children:i.jsx(k,{to:`/forms/${t.id}`,className:"text-textPrimary hover:text-primary line-clamp-1 text-base font-semibold",children:t.title})}),i.jsx("div",{className:"flex flex-grow items-center justify-center py-3 px-1 border-t border-b dark:border-border-dark",children:i.jsx("div",{className:"line-clamp-3 text-textPrimary text-sm",children:t.description})}),i.jsxs("div",{className:"flex justify-around items-center p-2",children:[i.jsx(k,{to:`/forms/${t.id}/responses`,className:"block w-full",children:i.jsx(Z,{block:!0,type:"text",icon:i.jsx(ve,{count:t.responseCount??0,showZero:!0,size:"small",styles:{indicator:{fontSize:10},root:{color:"inherit"}},children:i.jsx(Ae,{size:18})})})},"response"),i.jsx("div",{className:"border-l w-1 h-full ml-2 pl-2 dark:border-border-dark"}),i.jsx(k,{to:`/forms/${t.id}/edit`,className:"block w-full",children:i.jsx(Z,{block:!0,type:"text",icon:i.jsx(Le,{size:18})})},"edit"),i.jsx("div",{className:"border-l w-1 h-full ml-2 pl-2 dark:border-border-dark"}),i.jsx(Z,{block:!0,className:"block",type:"text","data-testid":"delete-button",danger:!0,icon:i.jsx(ke,{size:18}),onClick:o},"delete")]})]})},bt=e=>{const{items:t,onDelete:s}=e;return i.jsx(Ze,{gutter:[16,16],align:"stretch",children:t.map(o=>i.jsx(Ve,{span:24,md:12,lg:8,children:i.jsx(mt,{item:o,onDelete:s})},o.id))})};function ft(e,t){let s=null;return function(...o){s!==null&&clearTimeout(s),s=setTimeout(()=>{e.apply(this,o),s=null},t)}}const{Search:gt}=Xe,ee={TIME_ASC:{field:"createdAt",type:L.ASC},TIME_DESC:{field:"createdAt",type:L.DESC},TITLE_ASC:{field:"title",type:L.ASC},TITLE_DESC:{field:"title",type:L.DESC}},pt=[{value:"TIME_DESC",label:"Сначала новые"},{value:"TIME_ASC",label:"Сначала старые"},{value:"TITLE_DESC",label:"Порядок А-Я"},{value:"TITLE_ASC",label:"Порядок Я-А"}],ht=30,wt=()=>{const e=ze(),t=D(d=>d.formSlice.status),s=D(d=>d.user.user),o=D(d=>d.formSlice.order),n=D(d=>d.formSlice.search),u=D(d=>d.formSlice.data),c=D(d=>d.formSlice.hasNext),[v,C]=De(),[g,m]=a.useState(v.get("search")??""),[r,p]=a.useState(v.get("order")??"TIME_DESC"),[h]=Be(),{ref:b}=We({threshold:1,onChange:async d=>{d&&t!=="pending"&&f()}}),S=async d=>{try{await h(d).unwrap(),e(_e(d))}catch(I){console.error("Ошибка удаления:",I)}},x=ft(d=>{e(A()),m(d)},300),N=d=>{e(A()),p(d)};a.useEffect(()=>{const d={order:r};g.length&&(d.search=g),C(d,{replace:!0})},[r,g,C]),a.useEffect(()=>{var d,I;if(g!==(n??"")){e(A());return}if(((d=ee[r])==null?void 0:d.field)!==(o==null?void 0:o.field)||((I=ee[r])==null?void 0:I.type)!==(o==null?void 0:o.type)){e(A());return}},[]);const f=()=>{if(!s){Fe.error({message:"Не найдены данные пользователя"});return}e(He({search:g.length?{key:"title",value:g}:void 0,sort:ee[r],limit:ht,reference:{collectionName:"users",key:"userId",id:s.uid}}))},$=(t==="success"||t===null)&&c;return qe("Главная страница"),i.jsxs("div",{"data-testid":"home-page",className:"flex flex-col gap-4",children:[i.jsxs(te,{className:"p-5 flex-col sm:flex-row flex justify-between gap-4",children:[i.jsx(gt,{defaultValue:g,onSearch:x,className:"w-full sm:w-[300px]",disabled:t==="pending"}),i.jsx(Ue,{value:r,options:pt,onChange:N,className:"w-full sm:w-[200px]"})]}),i.jsxs(te,{className:"p-5",children:[u.length>0?i.jsx(bt,{items:u.filter(d=>d!==null),onDelete:S}):t!=="pending"&&!$&&i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx(de,{className:"!text-xl md:!text-2xl",children:"Нет доступных форм."}),i.jsx(k,{to:Me.FORMS_NEW,children:i.jsx(Z,{type:"primary",children:"Создать форму"})})]}),t==="pending"&&i.jsx(ue,{}),$&&i.jsx("div",{ref:b,className:"mt-4 mb-5",children:i.jsx(ue,{})}),t==="rejected"&&!u.length&&i.jsx(de,{level:4,children:"Произошла ошибка, попробуйте обновить страницу"})]})]})};export{wt as Home};
