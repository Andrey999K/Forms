import{h as P,k,l as I,by as M,bA as _,b as o,bx as l,j as t,L as R,S as b,bE as L,bH as Y,bI as $}from"./index-BdMAGVQa.js";import{S as j,u as V,C as G}from"./base-C4cWaxqm.js";import{P as H}from"./PageTitle-pgziiXI3.js";import{S as q}from"./index-DsgmbhyH.js";import{D as F}from"./index-y8rHWODq.js";import"./Skeleton-CVc2YT4N.js";import"./CloseOutlined-xqgsAjCj.js";import"./SearchOutlined-BsfAJr0X.js";const{Text:O,Title:m}=L,{RangePicker:Q}=F,z="YYYY-MM-DD",B=30,J={TIME_ASC:{field:"createdAt",type:j.ASC},TIME_DESC:{field:"createdAt",type:j.DESC}},K=[{value:"TIME_DESC",label:"Сначала новые"},{value:"TIME_ASC",label:"Сначала старые"}],re=()=>{const x=P(),n=k(e=>e.responseSlice.status),[c,f]=I(),{formId:u}=M(),{data:r}=_(u??""),[i,p]=o.useState([]),[d,y]=o.useState(c.get("sort")??"TIME_DESC"),[a,E]=o.useState({start:c.get("start")?l.unix(Number(c.get("start"))):null,end:c.get("end")?l.unix(Number(c.get("end"))):null}),[D,h]=o.useState(!0),v=(()=>{const e=[];if(a.start&&(e==null||e.push({key:"createdAt",operator:">=",value:new Date(l(a.start).toDate())})),a.end){let s=a.end.clone();s=s.add(1,"day"),e==null||e.push({key:"createdAt",operator:"<=",value:new Date(s.toDate())})}return e})(),{ref:C}=V({threshold:1,onChange:async e=>{e&&n!=="pending"&&A()}});o.useEffect(()=>{r&&(document.title=`Отклики на — Форма ${r.title}`)},[r]),o.useEffect(()=>{const e={sort:d};a.start&&(e.start=a.start.unix().toString()),a.end&&(e.end=a.end.unix().toString()),f(e,{replace:!0})},[d,a,f]);const N=e=>{g(),y(e)},w=(e,s)=>{g(),E({start:s[0]?l(s[0]):null,end:s[0]?l(s[1]):null})},A=()=>{x(Y({limit:B,reference:{collectionName:"form",id:u??"",key:"formId"},filters:v,sort:J[d]})).unwrap().then(e=>{const s=e.data.data??[];if(!s.length){h(!1);return}p(T=>[...T,...s])})},g=()=>{x($()),h(!0),p([])},S=(n==="success"||n===null)&&D;return t.jsxs(t.Fragment,{children:[t.jsx(H,{title:r?`Отклики | ${r.title}`:"Отклики"}),t.jsxs(m,{className:"mt-10 px-5 !text-2xl lg:px-0 md:!text-4xl",children:["Отклики формы ",t.jsx("br",{}),' "',r==null?void 0:r.title,'"']}),t.jsxs("div",{className:"flex flex-col w-full gap-2 mt-10 px-5 mb-4 lg:px-0 sm:justify-between sm:flex-row",children:[t.jsx(q,{defaultValue:d,onChange:N,options:K,disabled:!i.length,className:"w-full sm:w-[200px] text-left"}),t.jsx(Q,{defaultValue:[a.start,a.end],onChange:w,className:"w-full sm:max-w-[300px]",format:z,allowEmpty:!0,disabled:!i.length,maxDate:l()})]}),t.jsx("div",{className:"flex flex-col gap-4 mb-4 px-5 lg:px-0",children:i.length?i.map((e,s)=>t.jsx(R,{to:`/forms/${u}/responses/${e.id}`,children:t.jsx(G,{className:"bg-[#fdf8f4]/85 backdrop-blur-sm hover:backdrop-blur-sm hover:bg-[#fdf8f4] hover:-translate-y-1 hover:shadow-lg transition duration-200 ease-in-out",children:t.jsxs("div",{className:"flex items-center justify-between gap-5",children:[t.jsxs(m,{italic:!0,level:5,style:{margin:0},children:["Отклик #",s+1]}),t.jsx(O,{children:l(e.updatedAt).toString()})]})})},e.id)):n!=="pending"&&!S&&t.jsx(m,{level:2,children:"У данной формы нет откликов."})}),n==="pending"&&t.jsx("div",{className:"mb-5 mt-4",children:t.jsx(b,{})}),S&&t.jsx("div",{ref:C,className:"mt-4 mb-5",children:t.jsx(b,{})}),n==="rejected"&&!i.length&&t.jsx(m,{level:2,children:"Произошла ошибка, попробуйте обновить страницу"})]})};export{re as FormResponses};
