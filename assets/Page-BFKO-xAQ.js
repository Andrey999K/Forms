import{h as I,k as w,l as M,bx as P,bz as _,b as l,bw as r,j as t,L as R,S as j,bE as L,bH as Y,bI as V}from"./index-Be6W7ytg.js";import{S as b,u as $,C as G}from"./base-DxyAsU95.js";import{S as H}from"./index-B_AWdERt.js";import{D as q}from"./index-CKGmWIrJ.js";import"./Skeleton-Dl_j6E2_.js";import"./CloseOutlined-xPcgRUn4.js";import"./SearchOutlined-DFlbmcSt.js";const{Text:z,Title:u}=L,{RangePicker:O}=q,Q="YYYY-MM-DD",B=30,F={TIME_ASC:{field:"createdAt",type:b.ASC},TIME_DESC:{field:"createdAt",type:b.DESC}},J=[{value:"TIME_DESC",label:"Сначала новые"},{value:"TIME_ASC",label:"Сначала старые"}],se=()=>{const h=I(),n=w(e=>e.responseSlice.status),[c,f]=M(),{formId:m}=P(),{data:o}=_(m??""),[i,p]=l.useState([]),[d,y]=l.useState(c.get("sort")??"TIME_DESC"),[a,v]=l.useState({start:c.get("start")?r.unix(Number(c.get("start"))):null,end:c.get("end")?r.unix(Number(c.get("end"))):null}),[E,x]=l.useState(!0),D=(()=>{const e=[];if(a.start&&(e==null||e.push({key:"createdAt",operator:">=",value:new Date(r(a.start).toDate())})),a.end){let s=a.end.clone();s=s.add(1,"day"),e==null||e.push({key:"createdAt",operator:"<=",value:new Date(s.toDate())})}return e})(),{ref:C}=$({threshold:1,onChange:async e=>{e&&n!=="pending"&&T()}});l.useEffect(()=>{o&&(document.title=`Отклики на — Форма ${o.title}`)},[o]),l.useEffect(()=>{const e={sort:d};a.start&&(e.start=a.start.unix().toString()),a.end&&(e.end=a.end.unix().toString()),f(e,{replace:!0})},[d,a,f]);const N=e=>{g(),y(e)},A=(e,s)=>{g(),v({start:s[0]?r(s[0]):null,end:s[0]?r(s[1]):null})},T=()=>{h(Y({limit:B,reference:{collectionName:"form",id:m??"",key:"formId"},filters:D,sort:F[d]})).unwrap().then(e=>{const s=e.data.data??[];if(!s.length){x(!1);return}p(k=>[...k,...s])})},g=()=>{h(V()),x(!0),p([])},S=(n==="success"||n===null)&&E;return t.jsxs("div",{children:[t.jsxs(u,{level:1,className:"mt-10",children:["Отклики на — Форма ",o==null?void 0:o.title]}),t.jsxs("div",{className:"flex items-center justify-end w-full gap-2 mt-10",children:[t.jsx(H,{defaultValue:d,onChange:N,options:J,disabled:!i.length,className:"min-w-[20ch] text-left"}),t.jsx(O,{defaultValue:[a.start,a.end],onChange:A,className:"max-w-[30ch]",format:Q,disabled:!i.length,maxDate:r()})]}),t.jsx("div",{className:"flex flex-col gap-4 my-6",children:i.length?i.map((e,s)=>t.jsx(R,{to:`/forms/${m}/responses/${e.id}`,children:t.jsx(G,{className:"bg-[#fdf8f4]/85 backdrop-blur-sm hover:backdrop-blur-sm hover:bg-[#fdf8f4] hover:-translate-y-1 hover:shadow-lg transition duration-200 ease-in-out",children:t.jsxs("div",{className:"flex items-center justify-between gap-5",children:[t.jsxs(u,{italic:!0,level:5,style:{margin:0},children:["Отклик #",s+1]}),t.jsx(z,{children:r(e.updatedAt).toString()})]})})},e.id)):n!=="pending"&&!S&&t.jsx(u,{level:2,children:"У данной формы нет откликов."})}),n==="pending"&&t.jsx("div",{className:"mb-5 mt-4",children:t.jsx(j,{})}),S&&t.jsx("div",{ref:C,className:"mt-4 mb-5",children:t.jsx(j,{})}),n==="rejected"&&!i.length&&t.jsx(u,{level:2,children:"Произошла ошибка, попробуйте обновить страницу"})]})};export{se as FormResponses};
