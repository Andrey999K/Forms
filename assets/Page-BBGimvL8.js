import{g as ue,r as xe,u as X,b as i,C as ge,c as O,t as he,e as ye,v as je,w as ve,x as be,y as we,z as Ne,A as Ce,D as Se,_ as D,E as $e,F as Ie,H as Pe,I as Ee,J as ze,j as t,o as Q,S as Me,M as Oe,B as R,s as S,N as Re,T as Be,O as ke,P as Ue,G as A,Q as De}from"./index-CYtm5Ivz.js";import{c as Ae,d as F,e as H,f as L,g as T,h as q,i as _,j as V}from"./index-cf3E3JiM.js";import{U as z,a as M,u as K,C as Fe}from"./UserFormInput-ucnhghsn.js";import{I as He}from"./index-DJCO6rUO.js";import{R as G}from"./index-C9PH2wNh.js";import{F as E}from"./index-DiPSvnV-.js";import{u as Le}from"./usePageTitle-BgdMRMEQ.js";import"./row-D0k2i_7I.js";import"./index-fc85Zh8G.js";import"./responsiveObserver-BfmC1mZK.js";const P=(s,o,n,e,a)=>({background:s,border:`${X(e.lineWidth)} ${e.lineType} ${o}`,[`${a}-icon`]:{color:n}}),Te=s=>{const{componentCls:o,motionDurationSlow:n,marginXS:e,marginSM:a,fontSize:c,fontSizeLG:r,lineHeight:f,borderRadiusLG:p,motionEaseInOutCirc:u,withDescriptionIconSize:m,colorText:x,colorTextHeading:y,withDescriptionPadding:j,defaultPadding:d}=s;return{[o]:Object.assign(Object.assign({},xe(s)),{position:"relative",display:"flex",alignItems:"center",padding:d,wordWrap:"break-word",borderRadius:p,[`&${o}-rtl`]:{direction:"rtl"},[`${o}-content`]:{flex:1,minWidth:0},[`${o}-icon`]:{marginInlineEnd:e,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:f},"&-message":{color:y},[`&${o}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${n} ${u}, opacity ${n} ${u},
        padding-top ${n} ${u}, padding-bottom ${n} ${u},
        margin-bottom ${n} ${u}`},[`&${o}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${o}-with-description`]:{alignItems:"flex-start",padding:j,[`${o}-icon`]:{marginInlineEnd:a,fontSize:m,lineHeight:0},[`${o}-message`]:{display:"block",marginBottom:e,color:y,fontSize:r},[`${o}-description`]:{display:"block",color:x}},[`${o}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},_e=s=>{const{componentCls:o,colorSuccess:n,colorSuccessBorder:e,colorSuccessBg:a,colorWarning:c,colorWarningBorder:r,colorWarningBg:f,colorError:p,colorErrorBorder:u,colorErrorBg:m,colorInfo:x,colorInfoBorder:y,colorInfoBg:j}=s;return{[o]:{"&-success":P(a,e,n,s,o),"&-info":P(j,y,x,s,o),"&-warning":P(f,r,c,s,o),"&-error":Object.assign(Object.assign({},P(m,u,p,s,o)),{[`${o}-description > pre`]:{margin:0,padding:0}})}}},Ve=s=>{const{componentCls:o,iconCls:n,motionDurationMid:e,marginXS:a,fontSizeIcon:c,colorIcon:r,colorIconHover:f}=s;return{[o]:{"&-action":{marginInlineStart:a},[`${o}-close-icon`]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:c,lineHeight:X(c),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${n}-close`]:{color:r,transition:`color ${e}`,"&:hover":{color:f}}},"&-close-text":{color:r,transition:`color ${e}`,"&:hover":{color:f}}}}},Ge=s=>({withDescriptionIconSize:s.fontSizeHeading3,defaultPadding:`${s.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${s.paddingMD}px ${s.paddingContentHorizontalLG}px`}),We=ue("Alert",s=>[Te(s),_e(s),Ve(s)],Ge);var W=function(s,o){var n={};for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&o.indexOf(e)<0&&(n[e]=s[e]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,e=Object.getOwnPropertySymbols(s);a<e.length;a++)o.indexOf(e[a])<0&&Object.prototype.propertyIsEnumerable.call(s,e[a])&&(n[e[a]]=s[e[a]]);return n};const Je={success:we,info:Ne,error:Ce,warning:Se},Xe=s=>{const{icon:o,prefixCls:n,type:e}=s,a=Je[e]||null;return o?ve(o,i.createElement("span",{className:`${n}-icon`},o),()=>({className:O(`${n}-icon`,o.props.className)})):i.createElement(a,{className:`${n}-icon`})},Qe=s=>{const{isClosable:o,prefixCls:n,closeIcon:e,handleClose:a,ariaProps:c}=s,r=e===!0||e===void 0?i.createElement(be,null):e;return o?i.createElement("button",Object.assign({type:"button",onClick:a,className:`${n}-close-icon`,tabIndex:0},c),r):null},Y=i.forwardRef((s,o)=>{const{description:n,prefixCls:e,message:a,banner:c,className:r,rootClassName:f,style:p,onMouseEnter:u,onMouseLeave:m,onClick:x,afterClose:y,showIcon:j,closable:d,closeText:v,closeIcon:b,action:I,id:C}=s,N=W(s,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[$,ee]=i.useState(!1),B=i.useRef(null);i.useImperativeHandle(o,()=>({nativeElement:B.current}));const{getPrefixCls:te,direction:se,alert:l}=i.useContext(ge),g=te("alert",e),[oe,ne,ae]=We(g),re=h=>{var w;ee(!0),(w=s.onClose)===null||w===void 0||w.call(s,h)},k=i.useMemo(()=>s.type!==void 0?s.type:c?"warning":"info",[s.type,c]),ie=i.useMemo(()=>typeof d=="object"&&d.closeIcon||v?!0:typeof d=="boolean"?d:b!==!1&&b!==null&&b!==void 0?!0:!!(l!=null&&l.closable),[v,b,d,l==null?void 0:l.closable]),U=c&&j===void 0?!0:j,le=O(g,`${g}-${k}`,{[`${g}-with-description`]:!!n,[`${g}-no-icon`]:!U,[`${g}-banner`]:!!c,[`${g}-rtl`]:se==="rtl"},l==null?void 0:l.className,r,f,ae,ne),ce=he(N,{aria:!0,data:!0}),de=i.useMemo(()=>{var h,w;return typeof d=="object"&&d.closeIcon?d.closeIcon:v||(b!==void 0?b:typeof(l==null?void 0:l.closable)=="object"&&(!((h=l==null?void 0:l.closable)===null||h===void 0)&&h.closeIcon)?(w=l==null?void 0:l.closable)===null||w===void 0?void 0:w.closeIcon:l==null?void 0:l.closeIcon)},[b,d,v,l==null?void 0:l.closeIcon]),me=i.useMemo(()=>{const h=d??(l==null?void 0:l.closable);return typeof h=="object"?W(h,["closeIcon"]):{}},[d,l==null?void 0:l.closable]);return oe(i.createElement(ye,{visible:!$,motionName:`${g}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:h=>({maxHeight:h.offsetHeight}),onLeaveEnd:y},(h,w)=>{let{className:fe,style:pe}=h;return i.createElement("div",Object.assign({id:C,ref:je(B,w),"data-show":!$,className:O(le,fe),style:Object.assign(Object.assign(Object.assign({},l==null?void 0:l.style),p),pe),onMouseEnter:u,onMouseLeave:m,onClick:x,role:"alert"},ce),U?i.createElement(Xe,{description:n,icon:s.icon,prefixCls:g,type:k}):null,i.createElement("div",{className:`${g}-content`},a?i.createElement("div",{className:`${g}-message`},a):null,n?i.createElement("div",{className:`${g}-description`},n):null),I?i.createElement("div",{className:`${g}-action`},I):null,i.createElement(Qe,{isClosable:ie,prefixCls:g,closeIcon:de,handleClose:re,ariaProps:me}))}))});function qe(s,o,n){return o=D(o),$e(s,Ie()?Reflect.construct(o,n||[],D(s).constructor):o.apply(s,n))}let Ke=function(s){function o(){var n;return ze(this,o),n=qe(this,o,arguments),n.state={error:void 0,info:{componentStack:""}},n}return Pe(o,s),Ee(o,[{key:"componentDidCatch",value:function(e,a){this.setState({error:e,info:a})}},{key:"render",value:function(){const{message:e,description:a,id:c,children:r}=this.props,{error:f,info:p}=this.state,u=(p==null?void 0:p.componentStack)||null,m=typeof e>"u"?(f||"").toString():e,x=typeof a>"u"?u:a;return f?i.createElement(Y,{id:c,type:"error",message:m,description:i.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},x)}):r}}])}(i.Component);const Z=Y;Z.ErrorBoundary=Ke;const Ye=({currentAvatarUrl:s,isLoading:o,avatar:n})=>{const[e,a]=i.useState(null);i.useEffect(()=>{if(n){const r=new FileReader;r.onloadend=()=>a(r.result),r.readAsDataURL(n)}else a(null)},[n]);const c=e||s||"https://ui-avatars.com/api/?name=User&background=random";return o?t.jsx(Q,{}):t.jsx("div",{className:"flex justify-center w-full mb-6",children:t.jsx("div",{className:"flex flex-col gap-4",children:t.jsx("div",{className:"relative w-36 h-36 rounded-full overflow-hidden shadow-xl",children:t.jsx("img",{src:c,className:"w-full h-full object-cover",alt:"avatar"})})})})},Ze=({isEdit:s,dirtyFields:o,isValid:n,setEdit:e,isUpdating:a,avatar:c})=>{const r="absolute top-4 right-5 p-0 m-0 bg-transparent border-none transition-all duration-300 ease-in-out",f=`${r} ${!n||JSON.stringify(o)==="{}"?"opacity-30 cursor-not-allowed":"opacity-100 cursor-pointer hover:text-primary"}`,p=!n||JSON.stringify(o)==="{}"&&!c;return a?t.jsx(Me,{size:"large",className:r}):s?t.jsx("button",{type:"submit",className:f,disabled:p,children:t.jsx(Oe,{size:30})}):t.jsx("button",{className:r,onClick:()=>e(!0),children:t.jsx(Ae,{size:30,className:"cursor-pointer hover:text-primary"})})},J=s=>s?new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Дата не указана",et=({isEdit:s,control:o,reset:n,user:e,setEdit:a,setAvatar:c,isUpdating:r})=>{const f=()=>{n({firstName:(e==null?void 0:e.firstName)||"",lastName:(e==null?void 0:e.lastName)||""}),c(null),a(!1)},p=u=>{var x;const m=(x=u.target.files)==null?void 0:x[0];if(m){if(!(m.type==="image/jpeg"||m.type==="image/png"||m.type==="image/webp")){S.error({message:"Ошибка",description:"Для аватара можно загружать только форматы JPG/PNG/WEBP!"});return}if(!(m.size/1024/1024<8)){S.error({message:"Ошибка",description:"Файл должен быть меньше 8MB!"});return}c(m)}};return t.jsx(t.Fragment,{children:s?t.jsxs("div",{children:[t.jsxs("div",{className:"flex flex-col items-start mb-6",children:[t.jsx("label",{className:"ml-2",children:"Аватар"}),t.jsx(He,{type:"file",accept:"image/*",disabled:r,onChange:p,style:{height:"35.81px"},className:"text-textPrimary file:cursor-pointer file:bg-transparent file:border-none file:text-textPrimary py-1.5 px-4 rounded-lg"})]}),t.jsx(z,{control:o,disabled:r,label:"Имя",name:"firstName",placeholder:"Имя",prefix:t.jsx(T,{size:20,className:"mr-1"}),rules:M.name}),t.jsx(z,{control:o,disabled:r,name:"lastName",placeholder:"Фамилия",label:"Фамилия",prefix:t.jsx(T,{size:20,className:"mr-1"}),rules:M.surname}),t.jsxs("div",{className:"flex flex-col gap-5 mb-6",children:[t.jsxs("div",{className:"flex gap-2 items-center justify-start",children:[t.jsx(F,{size:20}),t.jsx("span",{className:"w-full text-lg font-semibold text-left break-words ",children:e==null?void 0:e.email})]}),t.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[t.jsx(H,{size:20}),t.jsx("span",{className:"w-full text-left",children:`Количество созданных форм: ${e==null?void 0:e.formsCount}`})]}),t.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[t.jsx(L,{size:20}),t.jsx("span",{className:"w-full text-left",children:`Дата регистрации: ${J(e==null?void 0:e.createdAt)}`})]})]}),t.jsx(R,{onClick:f,color:"danger",variant:"filled",icon:t.jsx(q,{size:15}),className:"w-full",style:{height:"33.79px"},children:"Отменить изменения"})]}):t.jsx("div",{className:"flex flex-col items-start gap-2",children:t.jsxs("div",{className:"flex flex-col items-start gap-2",children:[t.jsx("div",{className:"flex gap-2 items-start justify-start",children:t.jsx("span",{className:"w-full text-2xl font-bold text-left break-words",children:`${e==null?void 0:e.firstName} ${e==null?void 0:e.lastName}`})}),t.jsxs("div",{className:"flex gap-2 items-center justify-start",children:[t.jsx(F,{size:20}),t.jsx("span",{className:"break-words text-lg font-semibold text-left break-all",children:e==null?void 0:e.email})]}),t.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[t.jsx(H,{size:20}),t.jsx("span",{className:"w-full text-left",children:`Количество созданных форм: ${e==null?void 0:e.formsCount}`})]}),t.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[t.jsx(L,{size:20}),t.jsx("span",{className:"w-full text-left",children:`Дата регистрации: ${J(e==null?void 0:e.createdAt)}`})]})]})})})},tt=()=>{const[s,o]=i.useState(!1),[n,e]=i.useState(!1),[a,c]=i.useState(!1),[r,{isLoading:f}]=Re(),{control:p,handleSubmit:u,reset:m}=K({mode:"onBlur"}),x=()=>e(d=>!d),y=()=>c(d=>!d),j=async d=>{try{await r(d).unwrap(),S.success({message:"Пароль успешно обновлен"}),m()}catch(v){S.error({message:"Пароль не обновлён. Убедитесь, что текущий пароль введён правильно."}),console.error("Ошибка изменения пароля:",v)}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{onClick:()=>o(!s),className:`flex justify-center items-center cursor-pointer select-none ${s&&"mb-6"}`,children:t.jsx(Be.Title,{level:5,style:{marginBottom:0},className:"hover:text-primary transition-all duration-300 ease-in-out",children:"Изменить пароль"})}),s&&t.jsxs(E,{onFinish:u(j),layout:"vertical",className:"w-full",children:[t.jsx(z,{control:p,name:"currentPassword",type:n?"text":"password",placeholder:"Текущий пароль",rules:M.password,prefix:t.jsx(G,{size:20,className:"mr-1"}),suffix:t.jsx("span",{onClick:x,className:"flex items-center justify-center cursor-pointer p-0 m-0 h-auto w-auto hover:text-gray-500","aria-label":n?"hideCurrentPassword":"showCurrentPassword",children:n?t.jsx(_,{size:20}):t.jsx(V,{size:20})})}),t.jsx(z,{control:p,name:"newPassword",type:a?"text":"password",placeholder:"Новый пароль",rules:M.password,prefix:t.jsx(G,{size:20,className:"mr-1"}),suffix:t.jsx("span",{onClick:y,className:"flex items-center justify-center cursor-pointer p-0 m-0 h-auto w-auto hover:text-gray-500","aria-label":a?"hideNewPassword":"showNewPassword",children:a?t.jsx(_,{size:20}):t.jsx(V,{size:20})})}),t.jsx(E.Item,{children:t.jsx(R,{type:"primary",style:{height:"35.81px"},htmlType:"submit",loading:f,block:!0,children:"Обновить пароль"})}),t.jsx(E.Item,{className:"mb-0",children:t.jsx(R,{onClick:()=>{m(),o(!s)},color:"danger",variant:"filled",icon:t.jsx(q,{size:15}),className:"w-full",style:{height:"33.79px"},children:"Отменить"})})]})]})},ft=()=>{const[s,o]=i.useState(!1),[n,e]=i.useState(null),[a,c]=i.useState(localStorage.getItem("user"));i.useEffect(()=>{const C=localStorage.getItem("user");C&&c(C)},[]);const{data:r,error:f,isLoading:p}=ke(a||"",{skip:!a}),[u,{isLoading:m}]=Ue(),{control:x,handleSubmit:y,setValue:j,formState:{isValid:d,dirtyFields:v},reset:b}=K({mode:"onBlur"});i.useEffect(()=>{r&&b({firstName:(r==null?void 0:r.firstName)||"",lastName:(r==null?void 0:r.lastName)||""})},[r]),i.useEffect(()=>{n&&j("avatarUrl","uploaded",{shouldDirty:!0})},[n]);const I=async C=>{if(JSON.stringify(v)!=="{}"&&a)try{let N=(r==null?void 0:r.avatarUrl)||"";n&&(N=await De(n));const $={...C};N&&($.avatarUrl=N),await u({id:a,data:$}).unwrap(),S.success({message:"Данные успешно обновлены"}),e(null),o(!1)}catch(N){S.error({message:"Не удалось обновить данные"}),console.log("Ошибка обновления данных:",N)}};return Le("Профиль"),p?t.jsx(Q,{}):f||!r?t.jsx(Z,{message:"Ошибка",description:"Не удалось получить информацию о пользователе",type:"error",showIcon:!0}):t.jsx("div",{"data-testid":"me-page",children:t.jsxs(Fe,{className:"flex flex-col px-1 md:p-0 items-center md:flex-row gap-4 w-full md:items-start",children:[t.jsx(A,{className:"w-full min-w-56 md:w-1/2 px-5 py-5 text-center",style:{zIndex:10},children:t.jsxs(E,{onFinish:y(I),children:[t.jsx(Ze,{isEdit:s,dirtyFields:v,isValid:d,setEdit:o,isUpdating:m,avatar:n}),t.jsx(Ye,{currentAvatarUrl:r.avatarUrl,isLoading:p,setAvatar:e,avatar:n}),t.jsx(et,{isEdit:s,control:x,reset:b,user:r,setEdit:o,setAvatar:e,isUpdating:m})]})}),t.jsx(A,{className:"w-1/3 px-5 py-5 min-w-80  text-center",style:{zIndex:10},children:t.jsx(tt,{})})]})})};export{ft as Me};
