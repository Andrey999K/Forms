import{g as be,K as B,a as fe,r as ge,u as T,m as De,b as a,C as ne,i as pe,c as E,d as he,e as Re,j as r,B as M,G as xe,L as Z,f as ze,h as z,k as Me,l as Be,n as L,R as Fe,o as ue,T as _e,p as ke,s as ee,q as He}from"./index-sBAn8Z_x.js";import{S as A,u as We}from"./base-BGFHlxQv.js";import{M as Le,a as Ae,b as Ze}from"./index-Bni1adcW.js";import{M as Ve}from"./index-C0n_l1xV.js";import{R as qe,C as Ue}from"./row-D2LTNciG.js";import{u as Xe}from"./usePageTitle-BLgi8-SM.js";import{S as Ge}from"./index-6UmqGsrY.js";import{I as Ke}from"./index-NUZKde6u.js";import"./Skeleton-CkIjW8Ov.js";import"./index-BMzQyyLt.js";import"./fade-DVq-MtJt.js";import"./responsiveObserver-Dxf6T4Ud.js";const Ye=new B("antStatusProcessing",{"0%":{transform:"scale(0.8)",opacity:.5},"100%":{transform:"scale(2.4)",opacity:0}}),Qe=new B("antZoomBadgeIn",{"0%":{transform:"scale(0) translate(50%, -50%)",opacity:0},"100%":{transform:"scale(1) translate(50%, -50%)"}}),Je=new B("antZoomBadgeOut",{"0%":{transform:"scale(1) translate(50%, -50%)"},"100%":{transform:"scale(0) translate(50%, -50%)",opacity:0}}),et=new B("antNoWrapperZoomBadgeIn",{"0%":{transform:"scale(0)",opacity:0},"100%":{transform:"scale(1)"}}),tt=new B("antNoWrapperZoomBadgeOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)",opacity:0}}),ot=new B("antBadgeLoadingCircle",{"0%":{transformOrigin:"50%"},"100%":{transform:"translate(50%, -50%) rotate(360deg)",transformOrigin:"50%"}}),nt=e=>{const{componentCls:t,iconCls:s,antCls:o,badgeShadowSize:n,textFontSize:d,textFontSizeSM:i,statusSize:h,dotSize:v,textFontWeight:g,indicatorHeight:m,indicatorHeightSM:l,marginXS:p,calc:x}=e,b=`${o}-scroll-number`,S=fe(e,(C,N)=>{let{darkColor:f}=N;return{[`&${t} ${t}-color-${C}`]:{background:f,[`&:not(${t}-count)`]:{color:f},"a:hover &":{background:f}}}});return{[t]:Object.assign(Object.assign(Object.assign(Object.assign({},ge(e)),{position:"relative",display:"inline-block",width:"fit-content",lineHeight:1,[`${t}-count`]:{display:"inline-flex",justifyContent:"center",zIndex:e.indicatorZIndex,minWidth:m,height:m,color:e.badgeTextColor,fontWeight:g,fontSize:d,lineHeight:T(m),whiteSpace:"nowrap",textAlign:"center",background:e.badgeColor,borderRadius:x(m).div(2).equal(),boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`,transition:`background ${e.motionDurationMid}`,a:{color:e.badgeTextColor},"a:hover":{color:e.badgeTextColor},"a:hover &":{background:e.badgeColorHover}},[`${t}-count-sm`]:{minWidth:l,height:l,fontSize:i,lineHeight:T(l),borderRadius:x(l).div(2).equal()},[`${t}-multiple-words`]:{padding:`0 ${T(e.paddingXS)}`,bdi:{unicodeBidi:"plaintext"}},[`${t}-dot`]:{zIndex:e.indicatorZIndex,width:v,minWidth:v,height:v,background:e.badgeColor,borderRadius:"100%",boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`},[`${t}-count, ${t}-dot, ${b}-custom-component`]:{position:"absolute",top:0,insetInlineEnd:0,transform:"translate(50%, -50%)",transformOrigin:"100% 0%",[`&${s}-spin`]:{animationName:ot,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&${t}-status`]:{lineHeight:"inherit",verticalAlign:"baseline",[`${t}-status-dot`]:{position:"relative",top:-1,display:"inline-block",width:h,height:h,verticalAlign:"middle",borderRadius:"50%"},[`${t}-status-success`]:{backgroundColor:e.colorSuccess},[`${t}-status-processing`]:{overflow:"visible",color:e.colorInfo,backgroundColor:e.colorInfo,borderColor:"currentcolor","&::after":{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:"100%",borderWidth:n,borderStyle:"solid",borderColor:"inherit",borderRadius:"50%",animationName:Ye,animationDuration:e.badgeProcessingDuration,animationIterationCount:"infinite",animationTimingFunction:"ease-in-out",content:'""'}},[`${t}-status-default`]:{backgroundColor:e.colorTextPlaceholder},[`${t}-status-error`]:{backgroundColor:e.colorError},[`${t}-status-warning`]:{backgroundColor:e.colorWarning},[`${t}-status-text`]:{marginInlineStart:p,color:e.colorText,fontSize:e.fontSize}}}),S),{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:Qe,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`${t}-zoom-leave`]:{animationName:Je,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`&${t}-not-a-wrapper`]:{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:et,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`${t}-zoom-leave`]:{animationName:tt,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`&:not(${t}-status)`]:{verticalAlign:"middle"},[`${b}-custom-component, ${t}-count`]:{transform:"none"},[`${b}-custom-component, ${b}`]:{position:"relative",top:"auto",display:"block",transformOrigin:"50% 50%"}},[b]:{overflow:"hidden",transition:`all ${e.motionDurationMid} ${e.motionEaseOutBack}`,[`${b}-only`]:{position:"relative",display:"inline-block",height:m,transition:`all ${e.motionDurationSlow} ${e.motionEaseOutBack}`,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden",[`> p${b}-only-unit`]:{height:m,margin:0,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden"}},[`${b}-symbol`]:{verticalAlign:"top"}},"&-rtl":{direction:"rtl",[`${t}-count, ${t}-dot, ${b}-custom-component`]:{transform:"translate(-50%, -50%)"}}})}},Ce=e=>{const{fontHeight:t,lineWidth:s,marginXS:o,colorBorderBg:n}=e,d=t,i=s,h=e.colorTextLightSolid,v=e.colorError,g=e.colorErrorHover;return De(e,{badgeFontHeight:d,badgeShadowSize:i,badgeTextColor:h,badgeColor:v,badgeColorHover:g,badgeShadowColor:n,badgeProcessingDuration:"1.2s",badgeRibbonOffset:o,badgeRibbonCornerTransform:"scaleY(0.75)",badgeRibbonCornerFilter:"brightness(75%)"})},ve=e=>{const{fontSize:t,lineHeight:s,fontSizeSM:o,lineWidth:n}=e;return{indicatorZIndex:"auto",indicatorHeight:Math.round(t*s)-2*n,indicatorHeightSM:t,dotSize:o/2,textFontSize:o,textFontSizeSM:o,textFontWeight:"normal",statusSize:o/2}},st=be("Badge",e=>{const t=Ce(e);return nt(t)},ve),rt=e=>{const{antCls:t,badgeFontHeight:s,marginXS:o,badgeRibbonOffset:n,calc:d}=e,i=`${t}-ribbon`,h=`${t}-ribbon-wrapper`,v=fe(e,(g,m)=>{let{darkColor:l}=m;return{[`&${i}-color-${g}`]:{background:l,color:l}}});return{[h]:{position:"relative"},[i]:Object.assign(Object.assign(Object.assign(Object.assign({},ge(e)),{position:"absolute",top:o,padding:`0 ${T(e.paddingXS)}`,color:e.colorPrimary,lineHeight:T(s),whiteSpace:"nowrap",backgroundColor:e.colorPrimary,borderRadius:e.borderRadiusSM,[`${i}-text`]:{color:e.badgeTextColor},[`${i}-corner`]:{position:"absolute",top:"100%",width:n,height:n,color:"currentcolor",border:`${T(d(n).div(2).equal())} solid`,transform:e.badgeRibbonCornerTransform,transformOrigin:"top",filter:e.badgeRibbonCornerFilter}}),v),{[`&${i}-placement-end`]:{insetInlineEnd:d(n).mul(-1).equal(),borderEndEndRadius:0,[`${i}-corner`]:{insetInlineEnd:0,borderInlineEndColor:"transparent",borderBlockEndColor:"transparent"}},[`&${i}-placement-start`]:{insetInlineStart:d(n).mul(-1).equal(),borderEndStartRadius:0,[`${i}-corner`]:{insetInlineStart:0,borderBlockEndColor:"transparent",borderInlineStartColor:"transparent"}},"&-rtl":{direction:"rtl"}})}},at=be(["Badge","Ribbon"],e=>{const t=Ce(e);return rt(t)},ve),it=e=>{const{className:t,prefixCls:s,style:o,color:n,children:d,text:i,placement:h="end",rootClassName:v}=e,{getPrefixCls:g,direction:m}=a.useContext(ne),l=g("ribbon",s),p=`${l}-wrapper`,[x,b,S]=at(l,p),C=pe(n,!1),N=E(l,`${l}-placement-${h}`,{[`${l}-rtl`]:m==="rtl",[`${l}-color-${n}`]:C},t),f={},j={};return n&&!C&&(f.background=n,j.color=n),x(a.createElement("div",{className:E(p,v,b,S)},d,a.createElement("div",{className:E(N,b),style:Object.assign(Object.assign({},f),o)},a.createElement("span",{className:`${l}-text`},i),a.createElement("div",{className:`${l}-corner`,style:j}))))},me=e=>{const{prefixCls:t,value:s,current:o,offset:n=0}=e;let d;return n&&(d={position:"absolute",top:`${n}00%`,left:0}),a.createElement("span",{style:d,className:E(`${t}-only-unit`,{current:o})},s)};function lt(e,t,s){let o=e,n=0;for(;(o+10)%10!==t;)o+=s,n+=s;return n}const ct=e=>{const{prefixCls:t,count:s,value:o}=e,n=Number(o),d=Math.abs(s),[i,h]=a.useState(n),[v,g]=a.useState(d),m=()=>{h(n),g(d)};a.useEffect(()=>{const x=setTimeout(m,1e3);return()=>clearTimeout(x)},[n]);let l,p;if(i===n||Number.isNaN(n)||Number.isNaN(i))l=[a.createElement(me,Object.assign({},e,{key:n,current:!0}))],p={transition:"none"};else{l=[];const x=n+10,b=[];for(let f=n;f<=x;f+=1)b.push(f);const S=v<d?1:-1,C=b.findIndex(f=>f%10===i);l=(S<0?b.slice(0,C+1):b.slice(C)).map((f,j)=>{const I=f%10;return a.createElement(me,Object.assign({},e,{key:f,value:I,offset:S<0?j-C:j,current:j===C}))}),p={transform:`translateY(${-lt(i,n,S)}00%)`}}return a.createElement("span",{className:`${t}-only`,style:p,onTransitionEnd:m},l)};var dt=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const ut=a.forwardRef((e,t)=>{const{prefixCls:s,count:o,className:n,motionClassName:d,style:i,title:h,show:v,component:g="sup",children:m}=e,l=dt(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),{getPrefixCls:p}=a.useContext(ne),x=p("scroll-number",s),b=Object.assign(Object.assign({},l),{"data-show":v,style:i,className:E(x,n,d),title:h});let S=o;if(o&&Number(o)%1===0){const C=String(o).split("");S=a.createElement("bdi",null,C.map((N,f)=>a.createElement(ct,{prefixCls:x,count:Number(o),value:N,key:C.length-f})))}return i!=null&&i.borderColor&&(b.style=Object.assign(Object.assign({},i),{boxShadow:`0 0 0 1px ${i.borderColor} inset`})),m?he(m,C=>({className:E(`${x}-custom-component`,C==null?void 0:C.className,d)})):a.createElement(g,Object.assign({},b,{ref:t}),S)});var mt=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const bt=a.forwardRef((e,t)=>{var s,o,n,d,i;const{prefixCls:h,scrollNumberPrefixCls:v,children:g,status:m,text:l,color:p,count:x=null,overflowCount:b=99,dot:S=!1,size:C="default",title:N,offset:f,style:j,className:I,rootClassName:u,classNames:$,styles:w,showZero:V=!1}=e,se=mt(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","rootClassName","classNames","styles","showZero"]),{getPrefixCls:re,direction:q,badge:c}=a.useContext(ne),y=re("badge",h),[ae,Se,$e]=st(y),U=x>b?`${b}+`:x,_=U==="0"||U===0,Ne=x===null||_&&!V,X=(m!=null||p!=null)&&Ne,F=S&&!_,P=F?"":U,D=a.useMemo(()=>(P==null||P===""||_&&!V)&&!F,[P,_,V,F]),ie=a.useRef(x);D||(ie.current=x);const R=ie.current,le=a.useRef(P);D||(le.current=P);const G=le.current,ce=a.useRef(F);D||(ce.current=F);const k=a.useMemo(()=>{if(!f)return Object.assign(Object.assign({},c==null?void 0:c.style),j);const O={marginTop:f[1]};return q==="rtl"?O.left=parseInt(f[0],10):O.right=-parseInt(f[0],10),Object.assign(Object.assign(Object.assign({},O),c==null?void 0:c.style),j)},[q,f,j,c==null?void 0:c.style]),je=N??(typeof R=="string"||typeof R=="number"?R:void 0),we=D||!l?null:a.createElement("span",{className:`${y}-status-text`},l),Oe=!R||typeof R!="object"?void 0:he(R,O=>({style:Object.assign(Object.assign({},k),O.style)})),H=pe(p,!1),Ee=E($==null?void 0:$.indicator,(s=c==null?void 0:c.classNames)===null||s===void 0?void 0:s.indicator,{[`${y}-status-dot`]:X,[`${y}-status-${m}`]:!!m,[`${y}-color-${p}`]:H}),K={};p&&!H&&(K.color=p,K.background=p);const de=E(y,{[`${y}-status`]:X,[`${y}-not-a-wrapper`]:!g,[`${y}-rtl`]:q==="rtl"},I,u,c==null?void 0:c.className,(o=c==null?void 0:c.classNames)===null||o===void 0?void 0:o.root,$==null?void 0:$.root,Se,$e);if(!g&&X){const O=k.color;return ae(a.createElement("span",Object.assign({},se,{className:de,style:Object.assign(Object.assign(Object.assign({},w==null?void 0:w.root),(n=c==null?void 0:c.styles)===null||n===void 0?void 0:n.root),k)}),a.createElement("span",{className:Ee,style:Object.assign(Object.assign(Object.assign({},w==null?void 0:w.indicator),(d=c==null?void 0:c.styles)===null||d===void 0?void 0:d.indicator),K)}),l&&a.createElement("span",{style:{color:O},className:`${y}-status-text`},l)))}return ae(a.createElement("span",Object.assign({ref:t},se,{className:de,style:Object.assign(Object.assign({},(i=c==null?void 0:c.styles)===null||i===void 0?void 0:i.root),w==null?void 0:w.root)}),g,a.createElement(Re,{visible:!D,motionName:`${y}-zoom`,motionAppear:!1,motionDeadline:1e3},O=>{let{className:Te}=O;var Y,Q;const Ie=re("scroll-number",v),J=ce.current,Pe=E($==null?void 0:$.indicator,(Y=c==null?void 0:c.classNames)===null||Y===void 0?void 0:Y.indicator,{[`${y}-dot`]:J,[`${y}-count`]:!J,[`${y}-count-sm`]:C==="small",[`${y}-multiple-words`]:!J&&G&&G.toString().length>1,[`${y}-status-${m}`]:!!m,[`${y}-color-${p}`]:H});let W=Object.assign(Object.assign(Object.assign({},w==null?void 0:w.indicator),(Q=c==null?void 0:c.styles)===null||Q===void 0?void 0:Q.indicator),k);return p&&!H&&(W=W||{},W.background=p),a.createElement(ut,{prefixCls:Ie,show:!D,motionClassName:Te,className:Pe,count:G,title:je,style:W,key:"scrollNumber"},Oe)}),we))}),ye=bt;ye.Ribbon=it;const ft=e=>{const{isDeleting:t,onRemoveConstructor:s}=e,[o,n]=a.useState(!1),d=()=>{n(!0)},i=()=>{s()},h=()=>{n(!1)};return r.jsxs(r.Fragment,{children:[r.jsx(M,{block:!0,className:"block",type:"text","data-testid":"delete-button",danger:!0,icon:r.jsx(Le,{size:18}),onClick:d},"delete"),r.jsx(Ve,{title:"Удаление",open:o,onOk:i,confirmLoading:t,onCancel:h,footer:[r.jsx(M,{onClick:h,children:"Отмена"},"back"),r.jsx(M,{color:"danger",variant:"filled",loading:t,onClick:i,children:"Удалить"},"submit")],children:r.jsx("p",{children:"Вы действительно хотите удалить форму?"})})]})},gt=e=>{const{item:t,onDelete:s,isDeleting:o}=e,n=()=>{s(t.id)};return r.jsxs(xe,{className:"h-full flex flex-col !shadow-none",children:[r.jsx("div",{className:"py-3 px-1 flex items-center justify-center ",children:r.jsx(Z,{to:`/forms/${t.id}`,className:"text-textPrimary hover:text-primary line-clamp-1 text-base font-semibold",children:t.title})}),r.jsx("div",{className:"flex flex-grow items-center justify-center py-3 px-1 border-t border-b dark:border-border-dark",children:r.jsx("div",{className:"line-clamp-3 text-textPrimary text-sm",children:t.description})}),r.jsxs("div",{className:"flex justify-around items-center p-2",children:[r.jsx(Z,{to:`/forms/${t.id}/responses`,className:"block w-full",children:r.jsx(M,{block:!0,type:"text",icon:r.jsx(ye,{count:t.responseCount??0,showZero:!0,size:"small",styles:{indicator:{fontSize:10},root:{color:"inherit"}},children:r.jsx(Ae,{size:18})})})},"response"),r.jsx("div",{className:"border-l w-1 h-full ml-2 pl-2 dark:border-border-dark"}),r.jsx(Z,{to:`/forms/${t.id}/edit`,className:"block w-full",children:r.jsx(M,{block:!0,type:"text",icon:r.jsx(Ze,{size:18})})},"edit"),r.jsx("div",{className:"border-l w-1 h-full ml-2 pl-2 dark:border-border-dark"}),r.jsx(ft,{isDeleting:o,onRemoveConstructor:n})]})]})},pt=e=>{const{items:t,onDelete:s,isDeleting:o}=e;return r.jsx(qe,{gutter:[16,16],align:"stretch",children:t.map(n=>r.jsx(Ue,{span:24,md:12,lg:8,children:r.jsx(gt,{item:n,onDelete:s,isDeleting:o})},n.id))})};function ht(e,t){let s=null;return function(...o){s!==null&&clearTimeout(s),s=setTimeout(()=>{e.apply(this,o),s=null},t)}}const{Search:xt}=Ke,{Text:te}=_e,oe={TIME_ASC:{field:"createdAt",type:A.ASC},TIME_DESC:{field:"createdAt",type:A.DESC},TITLE_ASC:{field:"title",type:A.ASC},TITLE_DESC:{field:"title",type:A.DESC}},Ct=[{value:"TIME_DESC",label:"Сначала новые"},{value:"TIME_ASC",label:"Сначала старые"},{value:"TITLE_DESC",label:"Порядок А-Я"},{value:"TITLE_ASC",label:"Порядок Я-А"}],vt=30,Rt=()=>{const e=ze(),t=z(u=>u.formSlice.status),s=z(u=>u.user.user),o=z(u=>u.formSlice.order),n=z(u=>u.formSlice.search),d=z(u=>u.formSlice.data),i=z(u=>u.formSlice.hasNext),[h,v]=Me(),[g,m]=a.useState(h.get("search")??""),[l,p]=a.useState(h.get("order")??"TIME_DESC"),[x,{isLoading:b}]=Be(),{ref:S}=We({threshold:1,onChange:async u=>{u&&t!=="pending"&&j()}}),C=async u=>{try{await x(u).unwrap(),e(ke(u)),ee.info({message:"Форма успешно удалена"})}catch($){console.error("Ошибка удаления:",$),ee.error({message:"Ошибка"})}},N=ht(u=>{e(L()),m(u)},300),f=u=>{e(L()),p(u)};a.useEffect(()=>{const u={order:l};g.length&&(u.search=g),v(u,{replace:!0})},[l,g,v]),a.useEffect(()=>{var u,$;if(g!==(n??"")){e(L());return}if(((u=oe[l])==null?void 0:u.field)!==(o==null?void 0:o.field)||(($=oe[l])==null?void 0:$.type)!==(o==null?void 0:o.type)){e(L());return}},[]);const j=()=>{if(!s){ee.error({message:"Не найдены данные пользователя"});return}e(He({search:g.length?{key:"title",value:g}:void 0,sort:oe[l],limit:vt,reference:{collectionName:"users",key:"userId",id:s.uid}}))},I=(t==="success"||t===null)&&i;return Xe("Главная страница"),r.jsxs("div",{className:"flex flex-col gap-4 mt-[34.3px]",children:[r.jsx(te,{className:"!text-xl font-medium xl:px-0 md:!text-2xl self-start",children:"Мои формы"}),r.jsxs(xe,{"data-testid":"home-page",className:"flex flex-col gap-4 p-5 w-full",children:[r.jsxs("div",{className:"flex-col sm:flex-row flex justify-between gap-4",children:[r.jsx(xt,{defaultValue:g,onSearch:N,placeholder:"Найти",className:"w-full sm:w-[300px]",disabled:t==="pending"||!d.length&&!g}),r.jsx(Ge,{value:l,options:Ct,onChange:f,className:"w-full sm:w-[200px]",disabled:t==="pending"||!d.length,placeholder:["Начало","Конец"]})]}),r.jsxs("div",{children:[d.length>0?r.jsx(pt,{items:d.filter(u=>u!==null),onDelete:C,isDeleting:b}):t!=="pending"&&!I&&r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsx(te,{children:"Нет доступных форм."}),r.jsx(Z,{to:Fe.FORMS_NEW,children:r.jsx(M,{type:"primary",children:"Создать форму"})})]}),t==="pending"&&r.jsx(ue,{}),I&&r.jsx("div",{ref:S,className:"mt-4 mb-5",children:r.jsx(ue,{})}),t==="rejected"&&!d.length&&r.jsx(te,{children:"Произошла ошибка, попробуйте обновить страницу"})]})]})]})};export{Rt as Home};
