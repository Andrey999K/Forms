import{g as ue,K as B,a as me,r as be,u as T,m as Te,b as i,C as ee,i as ge,c as E,d as fe,e as Ie,j as d,L as Z,f as Pe,h as D,k as Re,l as ze,n as A,T as le,R as De,B as Be,S as ce,o as Me,s as Fe,p as _e}from"./index-DKiSfYVU.js";import{C as He,S as L,u as We}from"./base-wO-nA4XB.js";import{M as Ae,a as Le,b as Ze}from"./index-BayaFlfS.js";import{R as Ve,C as ke}from"./row-C91WiqjA.js";import{u as qe}from"./usePageTitle-C0a4UgZv.js";import{F as Ue}from"./index-CNH3JWe3.js";import{S as Xe}from"./index-BHsycVP7.js";import{I as Ke}from"./index-Ct0aK3ha.js";import"./Skeleton-qgtueHWt.js";import"./gapSize-U1swVQyS.js";import"./SearchOutlined-BHK5eFvk.js";import"./PlusOutlined-Dn-6bfYO.js";const Ye=new B("antStatusProcessing",{"0%":{transform:"scale(0.8)",opacity:.5},"100%":{transform:"scale(2.4)",opacity:0}}),Ge=new B("antZoomBadgeIn",{"0%":{transform:"scale(0) translate(50%, -50%)",opacity:0},"100%":{transform:"scale(1) translate(50%, -50%)"}}),Qe=new B("antZoomBadgeOut",{"0%":{transform:"scale(1) translate(50%, -50%)"},"100%":{transform:"scale(0) translate(50%, -50%)",opacity:0}}),Je=new B("antNoWrapperZoomBadgeIn",{"0%":{transform:"scale(0)",opacity:0},"100%":{transform:"scale(1)"}}),et=new B("antNoWrapperZoomBadgeOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)",opacity:0}}),tt=new B("antBadgeLoadingCircle",{"0%":{transformOrigin:"50%"},"100%":{transform:"translate(50%, -50%) rotate(360deg)",transformOrigin:"50%"}}),ot=e=>{const{componentCls:t,iconCls:s,antCls:o,badgeShadowSize:n,textFontSize:u,textFontSizeSM:l,statusSize:C,dotSize:x,textFontWeight:f,indicatorHeight:m,indicatorHeightSM:r,marginXS:p,calc:h}=e,b=`${o}-scroll-number`,y=me(e,(v,N)=>{let{darkColor:g}=N;return{[`&${t} ${t}-color-${v}`]:{background:g,[`&:not(${t}-count)`]:{color:g},"a:hover &":{background:g}}}});return{[t]:Object.assign(Object.assign(Object.assign(Object.assign({},be(e)),{position:"relative",display:"inline-block",width:"fit-content",lineHeight:1,[`${t}-count`]:{display:"inline-flex",justifyContent:"center",zIndex:e.indicatorZIndex,minWidth:m,height:m,color:e.badgeTextColor,fontWeight:f,fontSize:u,lineHeight:T(m),whiteSpace:"nowrap",textAlign:"center",background:e.badgeColor,borderRadius:h(m).div(2).equal(),boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`,transition:`background ${e.motionDurationMid}`,a:{color:e.badgeTextColor},"a:hover":{color:e.badgeTextColor},"a:hover &":{background:e.badgeColorHover}},[`${t}-count-sm`]:{minWidth:r,height:r,fontSize:l,lineHeight:T(r),borderRadius:h(r).div(2).equal()},[`${t}-multiple-words`]:{padding:`0 ${T(e.paddingXS)}`,bdi:{unicodeBidi:"plaintext"}},[`${t}-dot`]:{zIndex:e.indicatorZIndex,width:x,minWidth:x,height:x,background:e.badgeColor,borderRadius:"100%",boxShadow:`0 0 0 ${T(n)} ${e.badgeShadowColor}`},[`${t}-count, ${t}-dot, ${b}-custom-component`]:{position:"absolute",top:0,insetInlineEnd:0,transform:"translate(50%, -50%)",transformOrigin:"100% 0%",[`&${s}-spin`]:{animationName:tt,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&${t}-status`]:{lineHeight:"inherit",verticalAlign:"baseline",[`${t}-status-dot`]:{position:"relative",top:-1,display:"inline-block",width:C,height:C,verticalAlign:"middle",borderRadius:"50%"},[`${t}-status-success`]:{backgroundColor:e.colorSuccess},[`${t}-status-processing`]:{overflow:"visible",color:e.colorInfo,backgroundColor:e.colorInfo,borderColor:"currentcolor","&::after":{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:"100%",borderWidth:n,borderStyle:"solid",borderColor:"inherit",borderRadius:"50%",animationName:Ye,animationDuration:e.badgeProcessingDuration,animationIterationCount:"infinite",animationTimingFunction:"ease-in-out",content:'""'}},[`${t}-status-default`]:{backgroundColor:e.colorTextPlaceholder},[`${t}-status-error`]:{backgroundColor:e.colorError},[`${t}-status-warning`]:{backgroundColor:e.colorWarning},[`${t}-status-text`]:{marginInlineStart:p,color:e.colorText,fontSize:e.fontSize}}}),y),{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:Ge,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`${t}-zoom-leave`]:{animationName:Qe,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack,animationFillMode:"both"},[`&${t}-not-a-wrapper`]:{[`${t}-zoom-appear, ${t}-zoom-enter`]:{animationName:Je,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`${t}-zoom-leave`]:{animationName:et,animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseOutBack},[`&:not(${t}-status)`]:{verticalAlign:"middle"},[`${b}-custom-component, ${t}-count`]:{transform:"none"},[`${b}-custom-component, ${b}`]:{position:"relative",top:"auto",display:"block",transformOrigin:"50% 50%"}},[b]:{overflow:"hidden",transition:`all ${e.motionDurationMid} ${e.motionEaseOutBack}`,[`${b}-only`]:{position:"relative",display:"inline-block",height:m,transition:`all ${e.motionDurationSlow} ${e.motionEaseOutBack}`,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden",[`> p${b}-only-unit`]:{height:m,margin:0,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden"}},[`${b}-symbol`]:{verticalAlign:"top"}},"&-rtl":{direction:"rtl",[`${t}-count, ${t}-dot, ${b}-custom-component`]:{transform:"translate(-50%, -50%)"}}})}},pe=e=>{const{fontHeight:t,lineWidth:s,marginXS:o,colorBorderBg:n}=e,u=t,l=s,C=e.colorTextLightSolid,x=e.colorError,f=e.colorErrorHover;return Te(e,{badgeFontHeight:u,badgeShadowSize:l,badgeTextColor:C,badgeColor:x,badgeColorHover:f,badgeShadowColor:n,badgeProcessingDuration:"1.2s",badgeRibbonOffset:o,badgeRibbonCornerTransform:"scaleY(0.75)",badgeRibbonCornerFilter:"brightness(75%)"})},he=e=>{const{fontSize:t,lineHeight:s,fontSizeSM:o,lineWidth:n}=e;return{indicatorZIndex:"auto",indicatorHeight:Math.round(t*s)-2*n,indicatorHeightSM:t,dotSize:o/2,textFontSize:o,textFontSizeSM:o,textFontWeight:"normal",statusSize:o/2}},nt=ue("Badge",e=>{const t=pe(e);return ot(t)},he),st=e=>{const{antCls:t,badgeFontHeight:s,marginXS:o,badgeRibbonOffset:n,calc:u}=e,l=`${t}-ribbon`,C=`${t}-ribbon-wrapper`,x=me(e,(f,m)=>{let{darkColor:r}=m;return{[`&${l}-color-${f}`]:{background:r,color:r}}});return{[C]:{position:"relative"},[l]:Object.assign(Object.assign(Object.assign(Object.assign({},be(e)),{position:"absolute",top:o,padding:`0 ${T(e.paddingXS)}`,color:e.colorPrimary,lineHeight:T(s),whiteSpace:"nowrap",backgroundColor:e.colorPrimary,borderRadius:e.borderRadiusSM,[`${l}-text`]:{color:e.badgeTextColor},[`${l}-corner`]:{position:"absolute",top:"100%",width:n,height:n,color:"currentcolor",border:`${T(u(n).div(2).equal())} solid`,transform:e.badgeRibbonCornerTransform,transformOrigin:"top",filter:e.badgeRibbonCornerFilter}}),x),{[`&${l}-placement-end`]:{insetInlineEnd:u(n).mul(-1).equal(),borderEndEndRadius:0,[`${l}-corner`]:{insetInlineEnd:0,borderInlineEndColor:"transparent",borderBlockEndColor:"transparent"}},[`&${l}-placement-start`]:{insetInlineStart:u(n).mul(-1).equal(),borderEndStartRadius:0,[`${l}-corner`]:{insetInlineStart:0,borderBlockEndColor:"transparent",borderInlineStartColor:"transparent"}},"&-rtl":{direction:"rtl"}})}},rt=ue(["Badge","Ribbon"],e=>{const t=pe(e);return st(t)},he),it=e=>{const{className:t,prefixCls:s,style:o,color:n,children:u,text:l,placement:C="end",rootClassName:x}=e,{getPrefixCls:f,direction:m}=i.useContext(ee),r=f("ribbon",s),p=`${r}-wrapper`,[h,b,y]=rt(r,p),v=ge(n,!1),N=E(r,`${r}-placement-${C}`,{[`${r}-rtl`]:m==="rtl",[`${r}-color-${n}`]:v},t),g={},$={};return n&&!v&&(g.background=n,$.color=n),h(i.createElement("div",{className:E(p,x,b,y)},u,i.createElement("div",{className:E(N,b),style:Object.assign(Object.assign({},g),o)},i.createElement("span",{className:`${r}-text`},l),i.createElement("div",{className:`${r}-corner`,style:$}))))},de=e=>{const{prefixCls:t,value:s,current:o,offset:n=0}=e;let u;return n&&(u={position:"absolute",top:`${n}00%`,left:0}),i.createElement("span",{style:u,className:E(`${t}-only-unit`,{current:o})},s)};function at(e,t,s){let o=e,n=0;for(;(o+10)%10!==t;)o+=s,n+=s;return n}const lt=e=>{const{prefixCls:t,count:s,value:o}=e,n=Number(o),u=Math.abs(s),[l,C]=i.useState(n),[x,f]=i.useState(u),m=()=>{C(n),f(u)};i.useEffect(()=>{const h=setTimeout(m,1e3);return()=>clearTimeout(h)},[n]);let r,p;if(l===n||Number.isNaN(n)||Number.isNaN(l))r=[i.createElement(de,Object.assign({},e,{key:n,current:!0}))],p={transition:"none"};else{r=[];const h=n+10,b=[];for(let g=n;g<=h;g+=1)b.push(g);const y=x<u?1:-1,v=b.findIndex(g=>g%10===l);r=(y<0?b.slice(0,v+1):b.slice(v)).map((g,$)=>{const c=g%10;return i.createElement(de,Object.assign({},e,{key:g,value:c,offset:y<0?$-v:$,current:$===v}))}),p={transform:`translateY(${-at(l,n,y)}00%)`}}return i.createElement("span",{className:`${t}-only`,style:p,onTransitionEnd:m},r)};var ct=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const dt=i.forwardRef((e,t)=>{const{prefixCls:s,count:o,className:n,motionClassName:u,style:l,title:C,show:x,component:f="sup",children:m}=e,r=ct(e,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),{getPrefixCls:p}=i.useContext(ee),h=p("scroll-number",s),b=Object.assign(Object.assign({},r),{"data-show":x,style:l,className:E(h,n,u),title:C});let y=o;if(o&&Number(o)%1===0){const v=String(o).split("");y=i.createElement("bdi",null,v.map((N,g)=>i.createElement(lt,{prefixCls:h,count:Number(o),value:N,key:v.length-g})))}return l!=null&&l.borderColor&&(b.style=Object.assign(Object.assign({},l),{boxShadow:`0 0 0 1px ${l.borderColor} inset`})),m?fe(m,v=>({className:E(`${h}-custom-component`,v==null?void 0:v.className,u)})):i.createElement(f,Object.assign({},b,{ref:t}),y)});var ut=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const mt=i.forwardRef((e,t)=>{var s,o,n,u,l;const{prefixCls:C,scrollNumberPrefixCls:x,children:f,status:m,text:r,color:p,count:h=null,overflowCount:b=99,dot:y=!1,size:v="default",title:N,offset:g,style:$,className:c,rootClassName:I,classNames:w,styles:j,showZero:V=!1}=e,te=ut(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","rootClassName","classNames","styles","showZero"]),{getPrefixCls:oe,direction:k,badge:a}=i.useContext(ee),S=oe("badge",C),[ne,xe,Ce]=nt(S),q=h>b?`${b}+`:h,F=q==="0"||q===0,Se=h===null||F&&!V,U=(m!=null||p!=null)&&Se,M=y&&!F,P=M?"":q,R=i.useMemo(()=>(P==null||P===""||F&&!V)&&!M,[P,F,V,M]),se=i.useRef(h);R||(se.current=h);const z=se.current,re=i.useRef(P);R||(re.current=P);const X=re.current,ie=i.useRef(M);R||(ie.current=M);const _=i.useMemo(()=>{if(!g)return Object.assign(Object.assign({},a==null?void 0:a.style),$);const O={marginTop:g[1]};return k==="rtl"?O.left=parseInt(g[0],10):O.right=-parseInt(g[0],10),Object.assign(Object.assign(Object.assign({},O),a==null?void 0:a.style),$)},[k,g,$,a==null?void 0:a.style]),ye=N??(typeof z=="string"||typeof z=="number"?z:void 0),$e=R||!r?null:i.createElement("span",{className:`${S}-status-text`},r),Ne=!z||typeof z!="object"?void 0:fe(z,O=>({style:Object.assign(Object.assign({},_),O.style)})),H=ge(p,!1),je=E(w==null?void 0:w.indicator,(s=a==null?void 0:a.classNames)===null||s===void 0?void 0:s.indicator,{[`${S}-status-dot`]:U,[`${S}-status-${m}`]:!!m,[`${S}-color-${p}`]:H}),K={};p&&!H&&(K.color=p,K.background=p);const ae=E(S,{[`${S}-status`]:U,[`${S}-not-a-wrapper`]:!f,[`${S}-rtl`]:k==="rtl"},c,I,a==null?void 0:a.className,(o=a==null?void 0:a.classNames)===null||o===void 0?void 0:o.root,w==null?void 0:w.root,xe,Ce);if(!f&&U){const O=_.color;return ne(i.createElement("span",Object.assign({},te,{className:ae,style:Object.assign(Object.assign(Object.assign({},j==null?void 0:j.root),(n=a==null?void 0:a.styles)===null||n===void 0?void 0:n.root),_)}),i.createElement("span",{className:je,style:Object.assign(Object.assign(Object.assign({},j==null?void 0:j.indicator),(u=a==null?void 0:a.styles)===null||u===void 0?void 0:u.indicator),K)}),r&&i.createElement("span",{style:{color:O},className:`${S}-status-text`},r)))}return ne(i.createElement("span",Object.assign({ref:t},te,{className:ae,style:Object.assign(Object.assign({},(l=a==null?void 0:a.styles)===null||l===void 0?void 0:l.root),j==null?void 0:j.root)}),f,i.createElement(Ie,{visible:!R,motionName:`${S}-zoom`,motionAppear:!1,motionDeadline:1e3},O=>{let{className:Oe}=O;var Y,G;const we=oe("scroll-number",x),Q=ie.current,Ee=E(w==null?void 0:w.indicator,(Y=a==null?void 0:a.classNames)===null||Y===void 0?void 0:Y.indicator,{[`${S}-dot`]:Q,[`${S}-count`]:!Q,[`${S}-count-sm`]:v==="small",[`${S}-multiple-words`]:!Q&&X&&X.toString().length>1,[`${S}-status-${m}`]:!!m,[`${S}-color-${p}`]:H});let W=Object.assign(Object.assign(Object.assign({},j==null?void 0:j.indicator),(G=a==null?void 0:a.styles)===null||G===void 0?void 0:G.indicator),_);return p&&!H&&(W=W||{},W.background=p),i.createElement(dt,{prefixCls:we,show:!R,motionClassName:Oe,className:Ee,count:X,title:ye,style:W,key:"scrollNumber"},Ne)}),$e))}),ve=mt;ve.Ribbon=it;const bt=e=>{const{item:t,onDelete:s}=e,o=()=>{s(t.id)},n=[d.jsx(Z,{to:`/forms/${t.id}/responses`,children:d.jsx(ve,{count:t.responseCount??0,showZero:!0,size:"small",styles:{indicator:{fontSize:10},root:{color:"inherit"}},offset:[2,-2],children:d.jsx(Ae,{size:18,className:"text-textPrimary hover:text-linkHover transition-colors"})})},"response"),d.jsx(Z,{to:`/forms/${t.id}/edit`,children:d.jsx(Le,{size:18,style:{margin:"0 auto"},href:`/forms/${t.id}/edit`,className:"text-textPrimary hover:text-linkHover transition-colors"})},"edit"),d.jsx("div",{"data-testid":"delete-button",className:"text-red-600 hover:text-red-400 transition-all duration-200 ease-in-out cursor-pointer",onClick:o,children:d.jsx(Ze,{size:18,style:{margin:"0 auto"}})},"delete")],u=d.jsx(Z,{to:`/forms/${t.id}`,className:"text-textPrimary hover:text-primary",children:t.title});return d.jsx(He,{title:u,bordered:!1,actions:n,className:"h-full flex flex-col bg-bgPrimary shadow-custom",children:d.jsxs("div",{className:"flex flex-grow items-center justify-center",children:[d.jsx("div",{className:"line-clamp-3 text-textPrimary",children:t.description}),d.jsx("div",{className:"border-t border-border bg-transparent"})]})})},gt=e=>{const{items:t,onDelete:s}=e;return d.jsx(Ve,{gutter:[16,16],align:"stretch",children:t.map(o=>d.jsx(ke,{span:24,md:12,lg:8,children:d.jsx(bt,{item:o,onDelete:s})},o.id))})};function ft(e,t){let s=null;return function(...o){s!==null&&clearTimeout(s),s=setTimeout(()=>{e.apply(this,o),s=null},t)}}const{Search:pt}=Ke,J={TIME_ASC:{field:"createdAt",type:L.ASC},TIME_DESC:{field:"createdAt",type:L.DESC},TITLE_ASC:{field:"title",type:L.ASC},TITLE_DESC:{field:"title",type:L.DESC}},ht=[{value:"TIME_DESC",label:"Сначала новые"},{value:"TIME_ASC",label:"Сначала старые"},{value:"TITLE_DESC",label:"Порядок А-Я"},{value:"TITLE_ASC",label:"Порядок Я-А"}],vt=30,Pt=()=>{const e=Pe(),t=D(c=>c.formSlice.status),s=D(c=>c.user.user),o=D(c=>c.formSlice.order),n=D(c=>c.formSlice.search),u=D(c=>c.formSlice.data),l=D(c=>c.formSlice.hasNext),[C,x]=Re(),[f,m]=i.useState(C.get("search")??""),[r,p]=i.useState(C.get("order")??"TIME_DESC"),[h]=ze(),{ref:b}=We({threshold:1,onChange:async c=>{c&&t!=="pending"&&g()}}),y=async c=>{try{await h(c).unwrap(),e(Me(c))}catch(I){console.error("Ошибка удаления:",I)}},v=ft(c=>{e(A()),m(c)},300),N=c=>{e(A()),p(c)};i.useEffect(()=>{const c={order:r};f.length&&(c.search=f),x(c,{replace:!0})},[r,f,x]),i.useEffect(()=>{var c,I;if(f!==(n??"")){e(A());return}if(((c=J[r])==null?void 0:c.field)!==(o==null?void 0:o.field)||((I=J[r])==null?void 0:I.type)!==(o==null?void 0:o.type)){e(A());return}},[]);const g=()=>{if(!s){Fe.error({message:"Не найдены данные пользователя"});return}e(_e({search:f.length?{key:"title",value:f}:void 0,sort:J[r],limit:vt,reference:{collectionName:"users",key:"userId",id:s.uid}}))},$=(t==="success"||t===null)&&l;return qe("Главная страница"),d.jsxs("div",{"data-testid":"home-page",children:[d.jsxs(Ue,{justify:"space-between",gap:12,vertical:!0,className:"mb-4 sm:flex-row sm:mb-8",children:[d.jsx(pt,{defaultValue:f,onSearch:v,className:"w-full sm:w-[300px]"}),d.jsx(Xe,{value:r,options:ht,onChange:N,className:"w-full sm:w-[200px]"})]}),d.jsx("div",{className:"pb-5",children:u.length>0?d.jsx(gt,{items:u.filter(c=>c!==null),onDelete:y}):t!=="pending"&&!$&&d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx(le,{className:"!text-2xl md:!text-3xl",children:"Нет доступных форм."}),d.jsx(Z,{to:De.FORMS_NEW,children:d.jsx(Be,{type:"primary",children:"Создать форму"})})]})}),t==="pending"&&d.jsx("div",{className:"mb-5 mt-4",children:d.jsx(ce,{})}),$&&d.jsx("div",{ref:b,className:"mt-4 mb-5",children:d.jsx(ce,{})}),t==="rejected"&&!u.length&&d.jsx(le,{level:2,children:"Произошла ошибка, попробуйте обновить страницу"})]})};export{Pt as Home};
