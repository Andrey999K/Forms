import{g as xe,r as ge,u as X,b as i,C as he,c as O,t as ye,e as je,v as ve,w as be,x as we,y as Ne,z as Ce,A as Se,D as $e,_ as D,E as Ie,F as Pe,H as Ee,I as ze,J as Me,j as e,o as Q,S as Oe,M as Re,B as R,s as S,N as Be,T as q,O as ke,P as Ue,G as A,Q as De}from"./index-04I5l0VS.js";import{c as Ae,d as T,e as F,f as H,g as L,h as K,i as _,j as V}from"./index-fKtk4YJQ.js";import{U as z,a as M,u as Y,C as Te}from"./UserFormInput-DxkF609V.js";import{I as Fe}from"./index-CfOF3aTq.js";import{R as G}from"./index-tu2V-FoI.js";import{F as E}from"./index-B-Cb9b4-.js";import{u as He}from"./usePageTitle-nQ1xBVOI.js";import"./row-DSrH_jSh.js";import"./index-BfusRb26.js";import"./responsiveObserver-DTEbdiiO.js";const P=(s,o,n,t,a)=>({background:s,border:`${X(t.lineWidth)} ${t.lineType} ${o}`,[`${a}-icon`]:{color:n}}),Le=s=>{const{componentCls:o,motionDurationSlow:n,marginXS:t,marginSM:a,fontSize:c,fontSizeLG:r,lineHeight:f,borderRadiusLG:p,motionEaseInOutCirc:u,withDescriptionIconSize:m,colorText:x,colorTextHeading:y,withDescriptionPadding:j,defaultPadding:d}=s;return{[o]:Object.assign(Object.assign({},ge(s)),{position:"relative",display:"flex",alignItems:"center",padding:d,wordWrap:"break-word",borderRadius:p,[`&${o}-rtl`]:{direction:"rtl"},[`${o}-content`]:{flex:1,minWidth:0},[`${o}-icon`]:{marginInlineEnd:t,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:f},"&-message":{color:y},[`&${o}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${n} ${u}, opacity ${n} ${u},
        padding-top ${n} ${u}, padding-bottom ${n} ${u},
        margin-bottom ${n} ${u}`},[`&${o}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${o}-with-description`]:{alignItems:"flex-start",padding:j,[`${o}-icon`]:{marginInlineEnd:a,fontSize:m,lineHeight:0},[`${o}-message`]:{display:"block",marginBottom:t,color:y,fontSize:r},[`${o}-description`]:{display:"block",color:x}},[`${o}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},_e=s=>{const{componentCls:o,colorSuccess:n,colorSuccessBorder:t,colorSuccessBg:a,colorWarning:c,colorWarningBorder:r,colorWarningBg:f,colorError:p,colorErrorBorder:u,colorErrorBg:m,colorInfo:x,colorInfoBorder:y,colorInfoBg:j}=s;return{[o]:{"&-success":P(a,t,n,s,o),"&-info":P(j,y,x,s,o),"&-warning":P(f,r,c,s,o),"&-error":Object.assign(Object.assign({},P(m,u,p,s,o)),{[`${o}-description > pre`]:{margin:0,padding:0}})}}},Ve=s=>{const{componentCls:o,iconCls:n,motionDurationMid:t,marginXS:a,fontSizeIcon:c,colorIcon:r,colorIconHover:f}=s;return{[o]:{"&-action":{marginInlineStart:a},[`${o}-close-icon`]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:c,lineHeight:X(c),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${n}-close`]:{color:r,transition:`color ${t}`,"&:hover":{color:f}}},"&-close-text":{color:r,transition:`color ${t}`,"&:hover":{color:f}}}}},Ge=s=>({withDescriptionIconSize:s.fontSizeHeading3,defaultPadding:`${s.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${s.paddingMD}px ${s.paddingContentHorizontalLG}px`}),We=xe("Alert",s=>[Le(s),_e(s),Ve(s)],Ge);var W=function(s,o){var n={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&o.indexOf(t)<0&&(n[t]=s[t]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(s);a<t.length;a++)o.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(s,t[a])&&(n[t[a]]=s[t[a]]);return n};const Je={success:Ne,info:Ce,error:Se,warning:$e},Xe=s=>{const{icon:o,prefixCls:n,type:t}=s,a=Je[t]||null;return o?be(o,i.createElement("span",{className:`${n}-icon`},o),()=>({className:O(`${n}-icon`,o.props.className)})):i.createElement(a,{className:`${n}-icon`})},Qe=s=>{const{isClosable:o,prefixCls:n,closeIcon:t,handleClose:a,ariaProps:c}=s,r=t===!0||t===void 0?i.createElement(we,null):t;return o?i.createElement("button",Object.assign({type:"button",onClick:a,className:`${n}-close-icon`,tabIndex:0},c),r):null},Z=i.forwardRef((s,o)=>{const{description:n,prefixCls:t,message:a,banner:c,className:r,rootClassName:f,style:p,onMouseEnter:u,onMouseLeave:m,onClick:x,afterClose:y,showIcon:j,closable:d,closeText:v,closeIcon:b,action:I,id:C}=s,N=W(s,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[$,te]=i.useState(!1),B=i.useRef(null);i.useImperativeHandle(o,()=>({nativeElement:B.current}));const{getPrefixCls:se,direction:oe,alert:l}=i.useContext(he),g=se("alert",t),[ne,ae,re]=We(g),ie=h=>{var w;te(!0),(w=s.onClose)===null||w===void 0||w.call(s,h)},k=i.useMemo(()=>s.type!==void 0?s.type:c?"warning":"info",[s.type,c]),le=i.useMemo(()=>typeof d=="object"&&d.closeIcon||v?!0:typeof d=="boolean"?d:b!==!1&&b!==null&&b!==void 0?!0:!!(l!=null&&l.closable),[v,b,d,l==null?void 0:l.closable]),U=c&&j===void 0?!0:j,ce=O(g,`${g}-${k}`,{[`${g}-with-description`]:!!n,[`${g}-no-icon`]:!U,[`${g}-banner`]:!!c,[`${g}-rtl`]:oe==="rtl"},l==null?void 0:l.className,r,f,re,ae),de=ye(N,{aria:!0,data:!0}),me=i.useMemo(()=>{var h,w;return typeof d=="object"&&d.closeIcon?d.closeIcon:v||(b!==void 0?b:typeof(l==null?void 0:l.closable)=="object"&&(!((h=l==null?void 0:l.closable)===null||h===void 0)&&h.closeIcon)?(w=l==null?void 0:l.closable)===null||w===void 0?void 0:w.closeIcon:l==null?void 0:l.closeIcon)},[b,d,v,l==null?void 0:l.closeIcon]),fe=i.useMemo(()=>{const h=d??(l==null?void 0:l.closable);return typeof h=="object"?W(h,["closeIcon"]):{}},[d,l==null?void 0:l.closable]);return ne(i.createElement(je,{visible:!$,motionName:`${g}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:h=>({maxHeight:h.offsetHeight}),onLeaveEnd:y},(h,w)=>{let{className:pe,style:ue}=h;return i.createElement("div",Object.assign({id:C,ref:ve(B,w),"data-show":!$,className:O(ce,pe),style:Object.assign(Object.assign(Object.assign({},l==null?void 0:l.style),p),ue),onMouseEnter:u,onMouseLeave:m,onClick:x,role:"alert"},de),U?i.createElement(Xe,{description:n,icon:s.icon,prefixCls:g,type:k}):null,i.createElement("div",{className:`${g}-content`},a?i.createElement("div",{className:`${g}-message`},a):null,n?i.createElement("div",{className:`${g}-description`},n):null),I?i.createElement("div",{className:`${g}-action`},I):null,i.createElement(Qe,{isClosable:le,prefixCls:g,closeIcon:me,handleClose:ie,ariaProps:fe}))}))});function qe(s,o,n){return o=D(o),Ie(s,Pe()?Reflect.construct(o,n||[],D(s).constructor):o.apply(s,n))}let Ke=function(s){function o(){var n;return Me(this,o),n=qe(this,o,arguments),n.state={error:void 0,info:{componentStack:""}},n}return Ee(o,s),ze(o,[{key:"componentDidCatch",value:function(t,a){this.setState({error:t,info:a})}},{key:"render",value:function(){const{message:t,description:a,id:c,children:r}=this.props,{error:f,info:p}=this.state,u=(p==null?void 0:p.componentStack)||null,m=typeof t>"u"?(f||"").toString():t,x=typeof a>"u"?u:a;return f?i.createElement(Z,{id:c,type:"error",message:m,description:i.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},x)}):r}}])}(i.Component);const ee=Z;ee.ErrorBoundary=Ke;const Ye=({currentAvatarUrl:s,isLoading:o,avatar:n})=>{const[t,a]=i.useState(null);i.useEffect(()=>{if(n){const r=new FileReader;r.onloadend=()=>a(r.result),r.readAsDataURL(n)}else a(null)},[n]);const c=t||s||"https://ui-avatars.com/api/?name=User&background=random";return o?e.jsx(Q,{}):e.jsx("div",{className:"flex justify-center w-full mb-6",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx("div",{className:"relative w-36 h-36 rounded-full overflow-hidden shadow-xl",children:e.jsx("img",{src:c,className:"w-full h-full object-cover",alt:"avatar"})})})})},Ze=({isEdit:s,dirtyFields:o,isValid:n,setEdit:t,isUpdating:a,avatar:c})=>{const r="absolute top-4 right-5 p-0 m-0 bg-transparent border-none transition-all duration-300 ease-in-out",f=`${r} ${!n||JSON.stringify(o)==="{}"?"opacity-30 cursor-not-allowed":"opacity-100 cursor-pointer hover:text-primary"}`,p=!n||JSON.stringify(o)==="{}"&&!c;return a?e.jsx(Oe,{size:"large",className:r}):s?e.jsx("button",{type:"submit",className:f,disabled:p,children:e.jsx(Re,{size:30})}):e.jsx("button",{className:r,onClick:()=>t(!0),children:e.jsx(Ae,{size:30,className:"cursor-pointer hover:text-primary"})})},J=s=>s?new Date(s).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Дата не указана",et=({isEdit:s,control:o,reset:n,user:t,setEdit:a,setAvatar:c,isUpdating:r})=>{const f=()=>{n({firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||""}),c(null),a(!1)},p=u=>{var x;const m=(x=u.target.files)==null?void 0:x[0];if(m){if(!(m.type==="image/jpeg"||m.type==="image/png"||m.type==="image/webp")){S.error({message:"Ошибка",description:"Для аватара можно загружать только форматы JPG/PNG/WEBP!"});return}if(!(m.size/1024/1024<8)){S.error({message:"Ошибка",description:"Файл должен быть меньше 8MB!"});return}c(m)}};return e.jsx(e.Fragment,{children:s?e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-start mb-6",children:[e.jsx("label",{className:"ml-2",children:"Аватар"}),e.jsx(Fe,{type:"file",accept:"image/*",disabled:r,onChange:p,style:{height:"35.81px"},className:"text-textPrimary file:cursor-pointer file:bg-transparent file:border-none file:text-textPrimary py-1.5 px-4 rounded-lg"})]}),e.jsx(z,{control:o,disabled:r,label:"Имя",name:"firstName",placeholder:"Имя",prefix:e.jsx(L,{size:20,className:"mr-1"}),rules:M.name}),e.jsx(z,{control:o,disabled:r,name:"lastName",placeholder:"Фамилия",label:"Фамилия",prefix:e.jsx(L,{size:20,className:"mr-1"}),rules:M.surname}),e.jsxs("div",{className:"flex flex-col gap-5 mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center justify-start",children:[e.jsx(T,{size:20}),e.jsx("span",{className:"w-full text-lg font-semibold text-left break-words ",children:t==null?void 0:t.email})]}),e.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[e.jsx(F,{size:20}),e.jsx("span",{className:"w-full text-left",children:`Количество созданных форм: ${t==null?void 0:t.formsCount}`})]}),e.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[e.jsx(H,{size:20}),e.jsx("span",{className:"w-full text-left",children:`Дата регистрации: ${J(t==null?void 0:t.createdAt)}`})]})]}),e.jsx(R,{onClick:f,color:"danger",variant:"filled",icon:e.jsx(K,{size:15}),className:"w-full",style:{height:"33.79px"},children:"Отменить изменения"})]}):e.jsx("div",{className:"flex flex-col items-start gap-2",children:e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsx("div",{className:"flex gap-2 items-start justify-start",children:e.jsx("span",{className:"w-full text-2xl font-bold text-left break-words",children:`${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName}`})}),e.jsxs("div",{className:"flex gap-2 items-center justify-start",children:[e.jsx(T,{size:20}),e.jsx("span",{className:"break-words text-lg font-semibold text-left break-all",children:t==null?void 0:t.email})]}),e.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[e.jsx(F,{size:20}),e.jsx("span",{className:"w-full text-left",children:`Количество созданных форм: ${t==null?void 0:t.formsCount}`})]}),e.jsxs("div",{className:"flex gap-2 items-start justify-start",children:[e.jsx(H,{size:20}),e.jsx("span",{className:"w-full text-left",children:`Дата регистрации: ${J(t==null?void 0:t.createdAt)}`})]})]})})})},tt=()=>{const[s,o]=i.useState(!1),[n,t]=i.useState(!1),[a,c]=i.useState(!1),[r,{isLoading:f}]=Be(),{control:p,handleSubmit:u,reset:m}=Y({mode:"onBlur"}),x=()=>t(d=>!d),y=()=>c(d=>!d),j=async d=>{try{await r(d).unwrap(),S.success({message:"Пароль успешно обновлен"}),m()}catch(v){S.error({message:"Пароль не обновлён. Убедитесь, что текущий пароль введён правильно."}),console.error("Ошибка изменения пароля:",v)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!s),className:`flex justify-center items-center cursor-pointer select-none ${s&&"mb-6"}`,children:e.jsx(q.Title,{level:5,style:{marginBottom:0},className:"hover:text-primary transition-all duration-300 ease-in-out",children:"Изменить пароль"})}),s&&e.jsxs(E,{onFinish:u(j),layout:"vertical",className:"w-full",children:[e.jsx(z,{control:p,name:"currentPassword",type:n?"text":"password",placeholder:"Текущий пароль",rules:M.password,prefix:e.jsx(G,{size:20,className:"mr-1"}),suffix:e.jsx("span",{onClick:x,className:"flex items-center justify-center cursor-pointer p-0 m-0 h-auto w-auto hover:text-gray-500","aria-label":n?"hideCurrentPassword":"showCurrentPassword",children:n?e.jsx(_,{size:20}):e.jsx(V,{size:20})})}),e.jsx(z,{control:p,name:"newPassword",type:a?"text":"password",placeholder:"Новый пароль",rules:M.password,prefix:e.jsx(G,{size:20,className:"mr-1"}),suffix:e.jsx("span",{onClick:y,className:"flex items-center justify-center cursor-pointer p-0 m-0 h-auto w-auto hover:text-gray-500","aria-label":a?"hideNewPassword":"showNewPassword",children:a?e.jsx(_,{size:20}):e.jsx(V,{size:20})})}),e.jsx(E.Item,{children:e.jsx(R,{type:"primary",style:{height:"35.81px"},htmlType:"submit",loading:f,block:!0,children:"Обновить пароль"})}),e.jsx(E.Item,{className:"mb-0",children:e.jsx(R,{onClick:()=>{m(),o(!s)},color:"danger",variant:"filled",icon:e.jsx(K,{size:15}),className:"w-full",style:{height:"33.79px"},children:"Отменить"})})]})]})},ft=()=>{const[s,o]=i.useState(!1),[n,t]=i.useState(null),[a,c]=i.useState(localStorage.getItem("user"));i.useEffect(()=>{const C=localStorage.getItem("user");C&&c(C)},[]);const{data:r,error:f,isLoading:p}=ke(a||"",{skip:!a}),[u,{isLoading:m}]=Ue(),{control:x,handleSubmit:y,setValue:j,formState:{isValid:d,dirtyFields:v},reset:b}=Y({mode:"onBlur"});i.useEffect(()=>{r&&b({firstName:(r==null?void 0:r.firstName)||"",lastName:(r==null?void 0:r.lastName)||""})},[r]),i.useEffect(()=>{n&&j("avatarUrl","uploaded",{shouldDirty:!0})},[n]);const I=async C=>{if(JSON.stringify(v)!=="{}"&&a)try{let N=(r==null?void 0:r.avatarUrl)||"";n&&(N=await De(n));const $={...C};N&&($.avatarUrl=N),await u({id:a,data:$}).unwrap(),S.success({message:"Данные успешно обновлены"}),t(null),o(!1)}catch(N){S.error({message:"Не удалось обновить данные"}),console.log("Ошибка обновления данных:",N)}};return He("Профиль"),p?e.jsx(Q,{}):f||!r?e.jsx(ee,{message:"Ошибка",description:"Не удалось получить информацию о пользователе",type:"error",showIcon:!0}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(q.Text,{className:"!text-xl font-medium xl:px-0 md:!text-2xl self-start",children:"Мой профиль"}),e.jsx("div",{"data-testid":"me-page",children:e.jsxs(Te,{className:"flex flex-col px-1 md:p-0 items-center md:flex-row gap-4 w-full md:items-start",children:[e.jsx(A,{className:"w-full min-w-56 md:w-1/2 px-5 py-5 text-center",style:{zIndex:10},children:e.jsxs(E,{onFinish:y(I),children:[e.jsx(Ze,{isEdit:s,dirtyFields:v,isValid:d,setEdit:o,isUpdating:m,avatar:n}),e.jsx(Ye,{currentAvatarUrl:r.avatarUrl,isLoading:p,setAvatar:t,avatar:n}),e.jsx(et,{isEdit:s,control:x,reset:b,user:r,setEdit:o,setAvatar:t,isUpdating:m})]})}),e.jsx(A,{className:"w-1/3 px-5 py-5 min-w-80  text-center",style:{zIndex:10},children:e.jsx(tt,{})})]})})]})};export{ft as Me};
